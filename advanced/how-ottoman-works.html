<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How Ottoman Works | Ottoman.js</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Ottoman is an ODM built for Couchbase and Node.js. ">
    
    <link rel="preload" href="/assets/css/0.styles.caccd980.css" as="style"><link rel="preload" href="/assets/js/app.1cfa69bd.js" as="script"><link rel="preload" href="/assets/js/2.bbab3e56.js" as="script"><link rel="preload" href="/assets/js/6.871f4907.js" as="script"><link rel="prefetch" href="/assets/js/10.d28e5dd9.js"><link rel="prefetch" href="/assets/js/100.608d621e.js"><link rel="prefetch" href="/assets/js/101.7b29bda4.js"><link rel="prefetch" href="/assets/js/102.86a6798d.js"><link rel="prefetch" href="/assets/js/11.d232bdf4.js"><link rel="prefetch" href="/assets/js/12.7712523a.js"><link rel="prefetch" href="/assets/js/13.a863239f.js"><link rel="prefetch" href="/assets/js/14.d411b53e.js"><link rel="prefetch" href="/assets/js/15.ebbe8a18.js"><link rel="prefetch" href="/assets/js/16.9de17c93.js"><link rel="prefetch" href="/assets/js/17.0bb1a951.js"><link rel="prefetch" href="/assets/js/18.78ba45a0.js"><link rel="prefetch" href="/assets/js/19.4d99cb89.js"><link rel="prefetch" href="/assets/js/20.9ab2a1d9.js"><link rel="prefetch" href="/assets/js/21.1bf343f9.js"><link rel="prefetch" href="/assets/js/22.cb9539b9.js"><link rel="prefetch" href="/assets/js/23.0536f305.js"><link rel="prefetch" href="/assets/js/24.56ce7771.js"><link rel="prefetch" href="/assets/js/25.b0b4ea3a.js"><link rel="prefetch" href="/assets/js/26.3a58c194.js"><link rel="prefetch" href="/assets/js/27.948f3b73.js"><link rel="prefetch" href="/assets/js/28.945cae35.js"><link rel="prefetch" href="/assets/js/29.b16927e5.js"><link rel="prefetch" href="/assets/js/3.a8089fdd.js"><link rel="prefetch" href="/assets/js/30.3252c565.js"><link rel="prefetch" href="/assets/js/31.a08a49a4.js"><link rel="prefetch" href="/assets/js/32.ecbb8c68.js"><link rel="prefetch" href="/assets/js/33.78800a7e.js"><link rel="prefetch" href="/assets/js/34.3e09a062.js"><link rel="prefetch" href="/assets/js/35.828207df.js"><link rel="prefetch" href="/assets/js/36.0d598b88.js"><link rel="prefetch" href="/assets/js/37.726e66fb.js"><link rel="prefetch" href="/assets/js/38.88b7b660.js"><link rel="prefetch" href="/assets/js/39.044c02cf.js"><link rel="prefetch" href="/assets/js/4.5f3abae6.js"><link rel="prefetch" href="/assets/js/40.ba4c33a9.js"><link rel="prefetch" href="/assets/js/41.a78c9ae7.js"><link rel="prefetch" href="/assets/js/42.cf4b97c1.js"><link rel="prefetch" href="/assets/js/43.57946ee1.js"><link rel="prefetch" href="/assets/js/44.b44150fe.js"><link rel="prefetch" href="/assets/js/45.80476705.js"><link rel="prefetch" href="/assets/js/46.4d31276b.js"><link rel="prefetch" href="/assets/js/47.7c6dcb87.js"><link rel="prefetch" href="/assets/js/48.96096a85.js"><link rel="prefetch" href="/assets/js/49.661b8a74.js"><link rel="prefetch" href="/assets/js/5.358d6336.js"><link rel="prefetch" href="/assets/js/50.c4314871.js"><link rel="prefetch" href="/assets/js/51.2d25bd0a.js"><link rel="prefetch" href="/assets/js/52.6432a531.js"><link rel="prefetch" href="/assets/js/53.eefec48a.js"><link rel="prefetch" href="/assets/js/54.e7c70236.js"><link rel="prefetch" href="/assets/js/55.3fada008.js"><link rel="prefetch" href="/assets/js/56.17bdab46.js"><link rel="prefetch" href="/assets/js/57.1bbbb968.js"><link rel="prefetch" href="/assets/js/58.c08e48ba.js"><link rel="prefetch" href="/assets/js/59.c8e842d2.js"><link rel="prefetch" href="/assets/js/60.cb733a9f.js"><link rel="prefetch" href="/assets/js/61.f2e86e6c.js"><link rel="prefetch" href="/assets/js/62.f7c134d6.js"><link rel="prefetch" href="/assets/js/63.39fa83a7.js"><link rel="prefetch" href="/assets/js/64.03a618a4.js"><link rel="prefetch" href="/assets/js/65.c900f00d.js"><link rel="prefetch" href="/assets/js/66.6714f4f4.js"><link rel="prefetch" href="/assets/js/67.61bee287.js"><link rel="prefetch" href="/assets/js/68.4e7f929a.js"><link rel="prefetch" href="/assets/js/69.4f41fd6d.js"><link rel="prefetch" href="/assets/js/7.35b529da.js"><link rel="prefetch" href="/assets/js/70.cfd1df02.js"><link rel="prefetch" href="/assets/js/71.cf1b4450.js"><link rel="prefetch" href="/assets/js/72.e9bdec07.js"><link rel="prefetch" href="/assets/js/73.d4730a88.js"><link rel="prefetch" href="/assets/js/74.980b45d0.js"><link rel="prefetch" href="/assets/js/75.fdd02a30.js"><link rel="prefetch" href="/assets/js/76.2ff30101.js"><link rel="prefetch" href="/assets/js/77.c9d9184d.js"><link rel="prefetch" href="/assets/js/78.16d22861.js"><link rel="prefetch" href="/assets/js/79.e935681c.js"><link rel="prefetch" href="/assets/js/8.9b7af5cd.js"><link rel="prefetch" href="/assets/js/80.e6ac9c5e.js"><link rel="prefetch" href="/assets/js/81.ccee3bab.js"><link rel="prefetch" href="/assets/js/82.244a93e4.js"><link rel="prefetch" href="/assets/js/83.72938676.js"><link rel="prefetch" href="/assets/js/84.bb6bff7a.js"><link rel="prefetch" href="/assets/js/85.38dad887.js"><link rel="prefetch" href="/assets/js/86.5c476b4e.js"><link rel="prefetch" href="/assets/js/87.0be7b16d.js"><link rel="prefetch" href="/assets/js/88.ffd2c566.js"><link rel="prefetch" href="/assets/js/89.ab2ad4f4.js"><link rel="prefetch" href="/assets/js/9.d48342a1.js"><link rel="prefetch" href="/assets/js/90.b774681d.js"><link rel="prefetch" href="/assets/js/91.a466bd7e.js"><link rel="prefetch" href="/assets/js/92.590c950e.js"><link rel="prefetch" href="/assets/js/93.2200261c.js"><link rel="prefetch" href="/assets/js/94.d600deaa.js"><link rel="prefetch" href="/assets/js/95.aad38097.js"><link rel="prefetch" href="/assets/js/96.4daf336c.js"><link rel="prefetch" href="/assets/js/97.7881802f.js"><link rel="prefetch" href="/assets/js/98.7d40fa2e.js"><link rel="prefetch" href="/assets/js/99.913c8da8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.caccd980.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ottoman.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/faq.html" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  How Ottoman Works
</a></li><li class="dropdown-item"><!----> <a href="/advanced/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/mongoose-to-couchbase.html" class="nav-link">
  Mongoose to Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottoman-couchbase.html" class="nav-link">
  Ottoman for Couchbase Node.js SDK devs
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottomanV1-to-ottomanV2.html" class="nav-link">
  Ottoman V1 to Ottoman V2
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/faq.html" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  How Ottoman Works
</a></li><li class="dropdown-item"><!----> <a href="/advanced/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/mongoose-to-couchbase.html" class="nav-link">
  Mongoose to Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottoman-couchbase.html" class="nav-link">
  Ottoman for Couchbase Node.js SDK devs
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottomanV1-to-ottomanV2.html" class="nav-link">
  Ottoman V1 to Ottoman V2
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>How Ottoman Works</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced/how-ottoman-works.html#key-generation-layer" class="sidebar-link">Key Generation Layer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#keygenerator-function" class="sidebar-link">keyGenerator function</a></li></ul></li><li><a href="/advanced/how-ottoman-works.html#ottoman-vs-nodejs-sdk" class="sidebar-link">Ottoman vs NodeJS SDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#ottoman-schema-and-model-definitions" class="sidebar-link">Ottoman Schema and Model Definitions</a></li><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#ottoman-vs-sdk-connection" class="sidebar-link">Ottoman vs SDK Connection</a></li><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#model-find" class="sidebar-link">Model find</a></li><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#model-findoneandupdate" class="sidebar-link">Model findOneAndUpdate</a></li><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#model-findoneandremove" class="sidebar-link">Model findOneAndRemove</a></li></ul></li><li><a href="/advanced/how-ottoman-works.html#bulk-operations" class="sidebar-link">Bulk Operations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#create-many-documents" class="sidebar-link">Create Many Documents</a></li><li class="sidebar-sub-header"><a href="/advanced/how-ottoman-works.html#conclusions" class="sidebar-link">Conclusions</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-ottoman-works"><a href="#how-ottoman-works" class="header-anchor">#</a> How Ottoman Works</h1> <p>This section is for those who want to understand how Ottoman works in depth.</p> <h2 id="key-generation-layer"><a href="#key-generation-layer" class="header-anchor">#</a> Key Generation Layer</h2> <p>Ottoman provides an abstraction layer to handle the <code>keys</code> that will be used to store/access the documents on the Database Server.</p> <p>Developers will only have to work with the <code>document</code> ids while ottoman handles the keys automatically for them.</p> <h3 id="keygenerator-function"><a href="#keygenerator-function" class="header-anchor">#</a> <code>keyGenerator</code> function</h3> <p>The default <code>keyGenerator</code> function is used to generate all keys by Ottoman in your Couchbase datastore.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">keyGenerator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> metadata <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> metadata<span class="token punctuation">.</span>modelName <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Using the default <code>keyGenerator</code> function that Ottoman provides and assuming your <code>modelName</code> is 'User', the key for your document would look like:</p> <ul><li><code>User::0477024c</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">Notice</p> <p>This resulted key is a combination of the prefix as provided by the default  <code>keyGenerator</code> function (<code>${metadata.modelName}</code>) <a href="/guides/model.html#model-id">appended with an ID</a> (<code>0477024c</code>).</p></div> <h4 id="override-keygenerator-function"><a href="#override-keygenerator-function" class="header-anchor">#</a> Override <code>keyGenerator</code> function</h4> <p>The <code>keyGenerator</code> function allows you to only override the prefix for a key, or completely remove the prefix such that the key always matches the ID of the document generated.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">keyGenerator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> metadata <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> metadata<span class="token punctuation">.</span>scopeName <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> schema<span class="token punctuation">,</span> <span class="token punctuation">{</span> keyGenerator<span class="token punctuation">,</span> <span class="token literal-property property">scopeName</span><span class="token operator">:</span> <span class="token string">'myScope'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In this example we are overriding the <code>keyGenerator</code> function and replacing the <code>${metadata.modelName}</code> with <code>${metadata.scopeName}</code>. Using this override, the key for your document would look like:</p> <ul><li><code>myScope::0477024c</code></li></ul> <p>To understand how ID differs from keys in Ottoman we need to explore creating a model, understand how Ottoman deals with IDs which affect your key and then how to retrieve your document by ID.</p> <h4 id="defining-a-model"><a href="#defining-a-model" class="header-anchor">#</a> Defining a <code>Model</code></h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">...</span>
<span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol><li>Set your rules in the <code>Schema</code>.</li> <li>Now you can create your <code>Model</code> with the <code>Schema</code> defined.</li></ol> <h4 id="creating-a-document"><a href="#creating-a-document" class="header-anchor">#</a> Creating a Document</h4> <p>Let see how Ottoman handles a new document creation.</p> <p><img src="/assets/img/create.4d56bb71.png" alt="How to Use"></p> <div class="custom-block tip"><p class="custom-block-title">Notice</p> <p>Using Ottoman you only need to think about <code>id</code> in order to execute CRUD Operations over documents.
All the <code>key</code> management will be automatically handled by Ottoman.</p></div> <h4 id="retrieving-a-document"><a href="#retrieving-a-document" class="header-anchor">#</a> Retrieving a Document</h4> <p>Ottoman provides a <code>findById</code> method at the <code>Model</code> level to retrieve a document by <code>id</code>. See the picture below to understand how it works.</p> <p><img src="/assets/img/findById.d5aabf6e.png" alt="How to Use"></p> <h2 id="ottoman-vs-nodejs-sdk"><a href="#ottoman-vs-nodejs-sdk" class="header-anchor">#</a> Ottoman vs NodeJS SDK</h2> <p>In this section we will be reviewing some methods of the Ottoman Model, and comparing them with their respective implementation in the Couchbase NodeJs SDK.</p> <p>The environment on which these tests were run has the following characteristics:</p> <table><thead><tr><th>Info</th> <th>Properties</th></tr></thead> <tbody><tr><td>Processor</td> <td>Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz</td></tr> <tr><td>RAM</td> <td>16.0 GB</td></tr> <tr><td>System type</td> <td>64-bit operating system, x64-based processor</td></tr> <tr><td>Storage</td> <td>SSD 500GB</td></tr> <tr><td>SO</td> <td>Windows 10</td></tr> <tr><td><strong><em>Couchbase</em></strong></td> <td>Enterprise Edition 7.0.0</td></tr> <tr><td><strong><em>Couchbase Node.js SDK</em></strong></td> <td>v3.2.2</td></tr> <tr><td><strong><em>Ottoman</em></strong></td> <td>v2.0.0-beta.9</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">About metrics</p> <p>For metrics we run each example around a thousand times and take the average tests run time and <a href="https://nodejs.org/api/process.html#process_process" target="_blank" rel="noopener noreferrer">heapUsed*<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="heapused-is-the-actual-memory-used-during-the-process-execution-according-to-the-documentation-the-memory-used-by-c-objects-bound-to-javascript-objects-managed-by-v8"><a href="#heapused-is-the-actual-memory-used-during-the-process-execution-according-to-the-documentation-the-memory-used-by-c-objects-bound-to-javascript-objects-managed-by-v8" class="header-anchor">#</a> *<em>heapUsed</em>: is the actual memory used during the process execution, according to the documentation, the memory used by &quot;C++ objects bound to JavaScript objects managed by V8&quot;</h5></div> <h3 id="ottoman-schema-and-model-definitions"><a href="#ottoman-schema-and-model-definitions" class="header-anchor">#</a> Ottoman Schema and Model Definitions</h3> <p>We will use the data model corresponding to the type of <code>airport</code> collection, within the <code>travel-sample</code> bucket and scope <code>inventory</code>.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// Define Geolocation Schema will be part of Airport Schema</span>
<span class="token keyword">const</span> GeolocationSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  alt<span class="token operator">:</span> Number<span class="token punctuation">,</span>
  lat<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Number<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  lon<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Number<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  accuracy<span class="token operator">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define Airport Schema</span>
<span class="token keyword">const</span> AirportSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  airportname<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  city<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  country<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  faa<span class="token operator">:</span> String<span class="token punctuation">,</span>
  geo<span class="token operator">:</span> GeolocationSchema<span class="token punctuation">,</span>
  icao<span class="token operator">:</span> String<span class="token punctuation">,</span>
  tz<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Our model would look like this:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Define Airport model instance</span>
<span class="token keyword">const</span> AirportModel <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span>
  <span class="token string">'airport'</span><span class="token punctuation">,</span> <span class="token comment">// Model name (collection)</span>
  AirportSchema<span class="token punctuation">,</span> <span class="token comment">// Schema defined</span>
  <span class="token punctuation">{</span>
    modelKey<span class="token operator">:</span> <span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token comment">// Ottoman by default use `_type`</span>
    scopeName<span class="token operator">:</span> <span class="token string">'inventory'</span><span class="token punctuation">,</span> <span class="token comment">// Collection scope</span>
    keyGeneratorDelimiter<span class="token operator">:</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token comment">// By default Ottoman use ::</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="ottoman-vs-sdk-connection"><a href="#ottoman-vs-sdk-connection" class="header-anchor">#</a> Ottoman vs SDK Connection</h3> <p>Create our Ottoman instance and connect:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  connectionString<span class="token operator">:</span> <span class="token string">'couchbase://127.0.0.1'</span><span class="token punctuation">,</span>
  bucketName<span class="token operator">:</span> <span class="token string">'travel-sample'</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'password'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Couchbase NodeJs SDK cluster definition:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> cluster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">couchbase</span><span class="token punctuation">.</span><span class="token function">Cluster</span><span class="token punctuation">(</span><span class="token string">'couchbase://127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'password'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bucket <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">'travel-sample'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> collection <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token string">'inventory'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'airport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="model-find"><a href="#model-find" class="header-anchor">#</a> Model <em><a href="/interfaces/imodel.html#find">find</a></em></h3> <ul><li>Let's see a simple filterless search implementation.</li></ul> <h4 id="sdk"><a href="#sdk" class="header-anchor">#</a> SDK:</h4> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  SELECT *
  FROM \`travel-sample\`.\`inventory\`.\`airport\`
  WHERE type = &quot;airport&quot;
  LIMIT 1;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> cluster<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Result:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="ottoman"><a href="#ottoman" class="header-anchor">#</a> Ottoman:</h4> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> AirportModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Result:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Output:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Result: <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;airport&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1254</span>,
      <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;airport&quot;</span>,
      <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Calais Dunkerque&quot;</span>,
      <span class="token string">&quot;city&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Calais&quot;</span>,
      <span class="token string">&quot;country&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;France&quot;</span>,
      <span class="token string">&quot;faa&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CQF&quot;</span>,
      <span class="token string">&quot;icao&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;LFAC&quot;</span>,
      <span class="token string">&quot;tz&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Europe/Paris&quot;</span>,
      <span class="token string">&quot;geo&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">50.962097</span>,
        <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1.954764</span>,
        <span class="token string">&quot;alt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">Metrics</p> <table><thead><tr><th>Library</th> <th style="text-align:right;">Time (<em>ms</em>)</th> <th style="text-align:right;">Heap Use (<em>MB</em>)</th></tr></thead> <tbody><tr><td>Ottoman</td> <td style="text-align:right;">6.8</td> <td style="text-align:right;">9.1</td></tr> <tr><td>NodeJs SDK</td> <td style="text-align:right;">6</td> <td style="text-align:right;">9.6</td></tr></tbody></table></div> <ul><li>Now using some conditions and sort:</li></ul> <h4 id="sdk-2"><a href="#sdk-2" class="header-anchor">#</a> SDK:</h4> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  SELECT airportname
  FROM \`travel-sample\`.\`inventory\`.\`airport\`
  WHERE
    country = &quot;France&quot; AND
    airportname LIKE &quot;Aix%&quot; AND
    type = &quot;airport&quot;
  ORDER BY airportname ASC
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> cluster<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Result:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="ottoman-2"><a href="#ottoman-2" class="header-anchor">#</a> Ottoman:</h4> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> AirportModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> country<span class="token operator">:</span> <span class="token string">'France'</span><span class="token punctuation">,</span> airportname<span class="token operator">:</span> <span class="token punctuation">{</span> $like<span class="token operator">:</span> <span class="token string">'Aix%'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> select<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'airportname'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sort<span class="token operator">:</span> <span class="token punctuation">{</span> airportname<span class="token operator">:</span> <span class="token string">'ASC'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Result:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Output:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Result: <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Aix Les Bains&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Aix Les Milles&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">Metrics</p> <table><thead><tr><th>Library</th> <th style="text-align:right;">Time (<em>ms</em>)</th> <th style="text-align:right;">Heap Use (<em>MB</em>)</th></tr></thead> <tbody><tr><td>Ottoman</td> <td style="text-align:right;">3.47</td> <td style="text-align:right;">9.1</td></tr> <tr><td>NodeJs SDK</td> <td style="text-align:right;">3.43</td> <td style="text-align:right;">9.78</td></tr></tbody></table></div> <h3 id="model-findoneandupdate"><a href="#model-findoneandupdate" class="header-anchor">#</a> Model <em><a href="/interfaces/imodel.html#findoneandupdate">findOneAndUpdate</a></em></h3> <h4 id="sdk-3"><a href="#sdk-3" class="header-anchor">#</a> SDK:</h4> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  SELECT META().id as id
  FROM \`travel-sample\`.\`inventory\`.\`airport\`
  WHERE airportname LIKE &quot;Aix Les Bains%&quot;
    AND type = &quot;airport&quot;
  LIMIT 1
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> cluster<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> response<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> cas<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token operator">...</span>value<span class="token punctuation">,</span> airportname<span class="token operator">:</span> <span class="token string">'Aix Les Bains Updated'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> cas <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Result:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="ottoman-3"><a href="#ottoman-3" class="header-anchor">#</a> Ottoman:</h4> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> AirportModel<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> airportname<span class="token operator">:</span> <span class="token punctuation">{</span> $like<span class="token operator">:</span> <span class="token string">'Aix Les Bains%'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> airportname<span class="token operator">:</span> <span class="token string">'Aix Les Bains Updated'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token keyword">new</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// To get updated object</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Result:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Output:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Result: <span class="token punctuation">{</span>
  <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Aix Les Bains&quot;</span>,
  <span class="token string">&quot;city&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Chambery&quot;</span>,
  <span class="token string">&quot;country&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;France&quot;</span>,
  <span class="token string">&quot;faa&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CMF&quot;</span>,
  <span class="token string">&quot;geo&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">45.63805</span>,
    <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token number">5.880225</span>,
    <span class="token string">&quot;alt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">779</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;icao&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;LFLB&quot;</span>,
  <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1329</span>,
  <span class="token string">&quot;tz&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Europe/Paris&quot;</span>,
  <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;airport&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">Metrics</p> <table><thead><tr><th>Library</th> <th style="text-align:right;">Time (<em>ms</em>)</th> <th style="text-align:right;">Heap Use (<em>MB</em>)</th></tr></thead> <tbody><tr><td>Ottoman</td> <td style="text-align:right;">10.08</td> <td style="text-align:right;">10.49</td></tr> <tr><td>NodeJs SDK</td> <td style="text-align:right;">11.06</td> <td style="text-align:right;">7.95</td></tr></tbody></table></div> <h3 id="model-findoneandremove"><a href="#model-findoneandremove" class="header-anchor">#</a> Model <em><a href="/interfaces/imodel.html#findoneandremove">findOneAndRemove</a></em></h3> <h4 id="sdk-4"><a href="#sdk-4" class="header-anchor">#</a> SDK:</h4> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      SELECT META().id as id
      FROM \`travel-sample\`.\`inventory\`.\`airport\`
      WHERE airportname LIKE &quot;Aix Les Bains%&quot;
        AND type = &quot;airport&quot;
      LIMIT 1
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> cluster<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> response<span class="token punctuation">.</span>rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> cas <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">{</span> cas <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">RESULT: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Output:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>RESULT:  MutationResult <span class="token punctuation">{</span>
  cas: CbCas <span class="token punctuation">{</span> <span class="token string">'0'</span><span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>Buffer 00 00 09 f4 de <span class="token number">87</span> a2 <span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span> <span class="token punctuation">}</span>,
  token: undefined
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="ottoman-4"><a href="#ottoman-4" class="header-anchor">#</a> Ottoman:</h4> <p>In Ottoman using <code>findOneAndRemove</code> method we will have the document deleted as a result:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> AirportModel<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> airportname<span class="token operator">:</span> <span class="token punctuation">{</span> $like<span class="token operator">:</span> <span class="token string">'Aix Les Bains%'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Result:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Output:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Result: <span class="token punctuation">{</span>
  <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Aix Les Bains&quot;</span>,
  <span class="token string">&quot;city&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Chambery&quot;</span>,
  <span class="token string">&quot;country&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;France&quot;</span>,
  <span class="token string">&quot;faa&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CMF&quot;</span>,
  <span class="token string">&quot;geo&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">45.63805</span>,
    <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token number">5.880225</span>,
    <span class="token string">&quot;alt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">779</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;icao&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;LFLB&quot;</span>,
  <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1329</span>,
  <span class="token string">&quot;tz&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Europe/Paris&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">Metrics</p> <table><thead><tr><th>Library</th> <th style="text-align:right;">Time (<em>ms</em>)</th> <th style="text-align:right;">Heap Use (<em>MB</em>)</th></tr></thead> <tbody><tr><td>Ottoman</td> <td style="text-align:right;">11.44</td> <td style="text-align:right;">11.047</td></tr> <tr><td>NodeJs SDK</td> <td style="text-align:right;">14.86</td> <td style="text-align:right;">7.95*</td></tr></tbody></table></div> <h2 id="bulk-operations"><a href="#bulk-operations" class="header-anchor">#</a> Bulk Operations</h2> <p>Bulk operations describes how to operate on more than one document at the same time, this is a way to increasing network performance in to pipeline operations with <a href="https://docs.couchbase.com/nodejs-sdk/current/howtos/concurrent-async-apis.html#batching" target="_blank" rel="noopener noreferrer"><code>Batching Operations</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. As Node.js inherently performs all operations in an asynchronous manner, no special implementation is required in order to enable batching. Simply perform a number of operations simultaneously, and they will be batched on the network. This happens internally and is highly efficient. Let's see in action with Ottoman and Node SDK:</p> <h3 id="create-many-documents"><a href="#create-many-documents" class="header-anchor">#</a> Create Many Documents</h3> <p>For our example implementation we will use <code>bulkAirportDocs</code> array as defined next:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bulkAirportDocs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    airportname<span class="token operator">:</span> <span class="token string">'Airport test 1'</span><span class="token punctuation">,</span>
    city<span class="token operator">:</span> <span class="token string">'City A1'</span><span class="token punctuation">,</span>
    country<span class="token operator">:</span> <span class="token string">'Country A1'</span><span class="token punctuation">,</span>
    faa<span class="token operator">:</span> <span class="token string">'CA1'</span><span class="token punctuation">,</span>
    geo<span class="token operator">:</span> <span class="token punctuation">{</span>
      lat<span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
      lon<span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
      alt<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    icao<span class="token operator">:</span> <span class="token string">'CAC1'</span><span class="token punctuation">,</span>
    tz<span class="token operator">:</span> <span class="token string">'Europe/Paris'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    airportname<span class="token operator">:</span> <span class="token string">'Airport test 2'</span><span class="token punctuation">,</span>
    city<span class="token operator">:</span> <span class="token string">'City A2'</span><span class="token punctuation">,</span>
    country<span class="token operator">:</span> <span class="token string">'Country A2'</span><span class="token punctuation">,</span>
    faa<span class="token operator">:</span> <span class="token string">'CA2'</span><span class="token punctuation">,</span>
    geo<span class="token operator">:</span> <span class="token punctuation">{</span>
      lat<span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
      lon<span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
      alt<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    icao<span class="token operator">:</span> <span class="token string">'CAC2'</span><span class="token punctuation">,</span>
    tz<span class="token operator">:</span> <span class="token string">'Europe/Paris'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="sdk-5"><a href="#sdk-5" class="header-anchor">#</a> SDK</h4> <p>In the next example we will be using <a href="https://docs.couchbase.com/nodejs-sdk/current/howtos/kv-operations.html#crud-operations" target="_blank" rel="noopener noreferrer">Insert<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> operation for write a JSON document with a given ID (key) to the database applying batching operation strategy:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Note that this behaviour extends to the world of async/await,</span>
<span class="token comment">// such that following would be automatically batched across the network:</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
    bulkAirportDocs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">airport_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> doc<span class="token punctuation">.</span>id <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> newDoc <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">airport_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> doc<span class="token punctuation">.</span>id <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> newDoc<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">RESULT: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Output:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;b6027254-7071-4e76-9303-aa18f3b93bcd&quot;</span>,
    <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Airport test 1&quot;</span>,
    <span class="token string">&quot;city&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;City A1&quot;</span>,
    <span class="token string">&quot;country&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Country A1&quot;</span>,
    <span class="token string">&quot;faa&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CA1&quot;</span>,
    <span class="token string">&quot;geo&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;alt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;icao&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CAC1&quot;</span>,
    <span class="token string">&quot;tz&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Europe/Paris&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;d4331304-e321-45cb-89d2-23530240b9bd&quot;</span>,
    <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Airport test 2&quot;</span>,
    <span class="token string">&quot;city&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;City A2&quot;</span>,
    <span class="token string">&quot;country&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Country A2&quot;</span>,
    <span class="token string">&quot;faa&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CA2&quot;</span>,
    <span class="token string">&quot;geo&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;alt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;icao&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CAC2&quot;</span>,
    <span class="token string">&quot;tz&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Europe/Paris&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="ottoman-5"><a href="#ottoman-5" class="header-anchor">#</a> OTTOMAN</h4> <p>The way to do the same example above in Ottoman is as simple as using Model's <a href="/advanced/how-ottoman-works.html#bulk-operations">createMany</a> function as we can see below:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> AirportModel<span class="token punctuation">.</span><span class="token function">createMany</span><span class="token punctuation">(</span>bulkAirportDocs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Query failed: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Output:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;SUCCESS&quot;</span>,
  <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;success&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
    <span class="token string">&quot;match_number&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
    <span class="token string">&quot;errors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">&quot;data&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Airport test 1&quot;</span>,
        <span class="token string">&quot;city&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;City A1&quot;</span>,
        <span class="token string">&quot;country&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Country A1&quot;</span>,
        <span class="token string">&quot;faa&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CA1&quot;</span>,
        <span class="token string">&quot;geo&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
          <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
          <span class="token string">&quot;alt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;icao&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CAC1&quot;</span>,
        <span class="token string">&quot;tz&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Europe/Paris&quot;</span>,
        <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;b6027254-7071-4e76-9303-aa18f3b93bcd&quot;</span>,
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;airport&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span>
        <span class="token string">&quot;airportname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Airport test 2&quot;</span>,
        <span class="token string">&quot;city&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;City A2&quot;</span>,
        <span class="token string">&quot;country&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Country A2&quot;</span>,
        <span class="token string">&quot;faa&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CA2&quot;</span>,
        <span class="token string">&quot;geo&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
          <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
          <span class="token string">&quot;alt&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;icao&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CAC2&quot;</span>,
        <span class="token string">&quot;tz&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Europe/Paris&quot;</span>,
        <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;d4331304-e321-45cb-89d2-23530240b9bd&quot;</span>,
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;airport&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="conclusions"><a href="#conclusions" class="header-anchor">#</a> Conclusions</h3> <p>As can be appreciated for most of the search operations through filters in the Couchbase SDK, we must define our N1QL sentences while Ottoman internally takes care of it. Ottoman provides a method of interacting with a database using an object-oriented language, although it also allows the direct use of N1QL queries. Developers can interact with the database without becoming an expert in N1QL, which can save time and keep code streamlined, especially when is not that familiar with N1QL language, eliminating repetitive code and reducing the time taken in repetitive development tasks such as changes to the object model would be made in one place. The Ottoman abstraction layer allows us to focus exclusively on the use of the ODM and leave the management and interaction of the low-level database to it, however, insulates the developer from that layer, at times can potentially make it difficult to solve low-level problems.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1cfa69bd.js" defer></script><script src="/assets/js/2.bbab3e56.js" defer></script><script src="/assets/js/6.871f4907.js" defer></script>
  </body>
</html>
