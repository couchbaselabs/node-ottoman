<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ottoman for Couchbase Node.js SDK developers | Ottoman.js</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Ottoman is an ODM built for Couchbase and Node.js. ">
    
    <link rel="preload" href="/assets/css/0.styles.3356d12f.css" as="style"><link rel="preload" href="/assets/js/app.f67cace5.js" as="script"><link rel="preload" href="/assets/js/2.91685ef8.js" as="script"><link rel="preload" href="/assets/js/8.dbb9107b.js" as="script"><link rel="prefetch" href="/assets/js/10.136756ed.js"><link rel="prefetch" href="/assets/js/100.fb2423b1.js"><link rel="prefetch" href="/assets/js/101.50fdf4f1.js"><link rel="prefetch" href="/assets/js/102.1b7ab3c7.js"><link rel="prefetch" href="/assets/js/103.34928fbb.js"><link rel="prefetch" href="/assets/js/104.4b4c876f.js"><link rel="prefetch" href="/assets/js/105.0da30cf6.js"><link rel="prefetch" href="/assets/js/106.8234ef85.js"><link rel="prefetch" href="/assets/js/107.62aaa79a.js"><link rel="prefetch" href="/assets/js/108.71a63b5e.js"><link rel="prefetch" href="/assets/js/109.c704e77a.js"><link rel="prefetch" href="/assets/js/11.351d65d8.js"><link rel="prefetch" href="/assets/js/110.cc366c9f.js"><link rel="prefetch" href="/assets/js/111.ebd3cd06.js"><link rel="prefetch" href="/assets/js/112.7b7e5d12.js"><link rel="prefetch" href="/assets/js/113.8023b31e.js"><link rel="prefetch" href="/assets/js/114.327f330f.js"><link rel="prefetch" href="/assets/js/115.a13ca3a6.js"><link rel="prefetch" href="/assets/js/12.0eaa72e8.js"><link rel="prefetch" href="/assets/js/13.2beef5cc.js"><link rel="prefetch" href="/assets/js/14.a357daab.js"><link rel="prefetch" href="/assets/js/15.e44949c8.js"><link rel="prefetch" href="/assets/js/16.baa697b1.js"><link rel="prefetch" href="/assets/js/17.d4e72a57.js"><link rel="prefetch" href="/assets/js/18.f5f0f403.js"><link rel="prefetch" href="/assets/js/19.cb21d330.js"><link rel="prefetch" href="/assets/js/20.cb7d8bcd.js"><link rel="prefetch" href="/assets/js/21.1d6dfbe2.js"><link rel="prefetch" href="/assets/js/22.a9692f88.js"><link rel="prefetch" href="/assets/js/23.e3576fb8.js"><link rel="prefetch" href="/assets/js/24.23375cf6.js"><link rel="prefetch" href="/assets/js/25.4460e2cd.js"><link rel="prefetch" href="/assets/js/26.df15fc34.js"><link rel="prefetch" href="/assets/js/27.2027d820.js"><link rel="prefetch" href="/assets/js/28.64ceb778.js"><link rel="prefetch" href="/assets/js/29.d9854cbb.js"><link rel="prefetch" href="/assets/js/3.c24dc5dc.js"><link rel="prefetch" href="/assets/js/30.8c3c235a.js"><link rel="prefetch" href="/assets/js/31.79e75bb3.js"><link rel="prefetch" href="/assets/js/32.66744c83.js"><link rel="prefetch" href="/assets/js/33.5f5841ec.js"><link rel="prefetch" href="/assets/js/34.4a4e28b8.js"><link rel="prefetch" href="/assets/js/35.0e4d66c9.js"><link rel="prefetch" href="/assets/js/36.4b90ba2f.js"><link rel="prefetch" href="/assets/js/37.868224e7.js"><link rel="prefetch" href="/assets/js/38.760e857f.js"><link rel="prefetch" href="/assets/js/39.0f6efda3.js"><link rel="prefetch" href="/assets/js/4.14b96c59.js"><link rel="prefetch" href="/assets/js/40.cab9a643.js"><link rel="prefetch" href="/assets/js/41.97ee4fca.js"><link rel="prefetch" href="/assets/js/42.e4dae5b2.js"><link rel="prefetch" href="/assets/js/43.361db389.js"><link rel="prefetch" href="/assets/js/44.efcb50d1.js"><link rel="prefetch" href="/assets/js/45.c6537402.js"><link rel="prefetch" href="/assets/js/46.fd53c8d8.js"><link rel="prefetch" href="/assets/js/47.2f383dd7.js"><link rel="prefetch" href="/assets/js/48.4e0eb494.js"><link rel="prefetch" href="/assets/js/49.066a74e7.js"><link rel="prefetch" href="/assets/js/5.72d44663.js"><link rel="prefetch" href="/assets/js/50.58f5ad8c.js"><link rel="prefetch" href="/assets/js/51.9ec5bd2c.js"><link rel="prefetch" href="/assets/js/52.d57fe916.js"><link rel="prefetch" href="/assets/js/53.e1b5b3ad.js"><link rel="prefetch" href="/assets/js/54.99e52fb4.js"><link rel="prefetch" href="/assets/js/55.d5648595.js"><link rel="prefetch" href="/assets/js/56.78341efa.js"><link rel="prefetch" href="/assets/js/57.c565adca.js"><link rel="prefetch" href="/assets/js/58.b0629b92.js"><link rel="prefetch" href="/assets/js/59.6dd7aa3e.js"><link rel="prefetch" href="/assets/js/6.0a7e9a10.js"><link rel="prefetch" href="/assets/js/60.557f0fc8.js"><link rel="prefetch" href="/assets/js/61.4555d956.js"><link rel="prefetch" href="/assets/js/62.eb19446c.js"><link rel="prefetch" href="/assets/js/63.c8a3a557.js"><link rel="prefetch" href="/assets/js/64.6dc8b596.js"><link rel="prefetch" href="/assets/js/65.85b50252.js"><link rel="prefetch" href="/assets/js/66.84f972af.js"><link rel="prefetch" href="/assets/js/67.0ca1c3e9.js"><link rel="prefetch" href="/assets/js/68.df8ce023.js"><link rel="prefetch" href="/assets/js/69.77b0b603.js"><link rel="prefetch" href="/assets/js/7.fbd42597.js"><link rel="prefetch" href="/assets/js/70.3d929597.js"><link rel="prefetch" href="/assets/js/71.172451fc.js"><link rel="prefetch" href="/assets/js/72.01f72b87.js"><link rel="prefetch" href="/assets/js/73.8b9345d4.js"><link rel="prefetch" href="/assets/js/74.d83df257.js"><link rel="prefetch" href="/assets/js/75.3eff604e.js"><link rel="prefetch" href="/assets/js/76.076a3437.js"><link rel="prefetch" href="/assets/js/77.60b3017f.js"><link rel="prefetch" href="/assets/js/78.5ce41afc.js"><link rel="prefetch" href="/assets/js/79.3067f233.js"><link rel="prefetch" href="/assets/js/80.470f4128.js"><link rel="prefetch" href="/assets/js/81.bcdee74b.js"><link rel="prefetch" href="/assets/js/82.157ec86d.js"><link rel="prefetch" href="/assets/js/83.6cae5767.js"><link rel="prefetch" href="/assets/js/84.f2510e86.js"><link rel="prefetch" href="/assets/js/85.93a29d2c.js"><link rel="prefetch" href="/assets/js/86.8a4b7181.js"><link rel="prefetch" href="/assets/js/87.16664c7a.js"><link rel="prefetch" href="/assets/js/88.cc9a952e.js"><link rel="prefetch" href="/assets/js/89.33ff65d5.js"><link rel="prefetch" href="/assets/js/9.938b3bc4.js"><link rel="prefetch" href="/assets/js/90.17282026.js"><link rel="prefetch" href="/assets/js/91.24a475d4.js"><link rel="prefetch" href="/assets/js/92.568f3a5a.js"><link rel="prefetch" href="/assets/js/93.9a37560f.js"><link rel="prefetch" href="/assets/js/94.00852809.js"><link rel="prefetch" href="/assets/js/95.7d5b10e2.js"><link rel="prefetch" href="/assets/js/96.8a773950.js"><link rel="prefetch" href="/assets/js/97.c97a5124.js"><link rel="prefetch" href="/assets/js/98.f0b46a96.js"><link rel="prefetch" href="/assets/js/99.146f2756.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3356d12f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ottoman.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/faq.html" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li><li class="dropdown-item"><!----> <a href="/guides/mongoose-to-couchbase.html" class="nav-link">
  Mongoose to Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottoman-couchbase.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Ottoman for Couchbase Node.js SDK devs
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottomanV1-to-ottomanV2.html" class="nav-link">
  Ottoman V1 to Ottoman V2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" class="nav-link">
  How Ottoman Works
</a></li><li class="dropdown-item"><!----> <a href="/advanced/ottoman.html" class="nav-link">
  Ottoman
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/faq.html" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li><li class="dropdown-item"><!----> <a href="/guides/mongoose-to-couchbase.html" class="nav-link">
  Mongoose to Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottoman-couchbase.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Ottoman for Couchbase Node.js SDK devs
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottomanV1-to-ottomanV2.html" class="nav-link">
  Ottoman V1 to Ottoman V2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" class="nav-link">
  How Ottoman Works
</a></li><li class="dropdown-item"><!----> <a href="/advanced/ottoman.html" class="nav-link">
  Ottoman
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ottoman for Couchbase Node.js SDK developers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guides/ottoman-couchbase.html#why-use-an-odm-for-couchbase" class="sidebar-link">Why Use an ODM for Couchbase</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#nosql-database-and-schema-design" class="sidebar-link">NoSQL Database and Schema Design</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#types" class="sidebar-link">Types</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#collections" class="sidebar-link">Collections</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#documents" class="sidebar-link">Documents</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#fields" class="sidebar-link">Fields</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#schema" class="sidebar-link">Schema</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#model" class="sidebar-link">Model</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman-couchbase.html#getting-started" class="sidebar-link">Getting Started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#couchbase-installation" class="sidebar-link">Couchbase Installation</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#initializing-our-project-with-npm" class="sidebar-link">Initializing our Project with NPM</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#connection-to-couchbase-with-ottoman" class="sidebar-link">Connection to Couchbase with Ottoman</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#ottoman-schema-and-models" class="sidebar-link">Ottoman Schema and Models</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#defining-a-document-schema" class="sidebar-link">Defining a Document Schema</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#defining-a-document-model" class="sidebar-link">Defining a Document Model</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#defining-validators" class="sidebar-link">Defining Validators</a></li></ul></li><li><a href="/guides/ottoman-couchbase.html#basic-document-operations-in-nosql" class="sidebar-link">Basic Document Operations in NoSQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#create-documents" class="sidebar-link">Create Documents</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#validation-errors" class="sidebar-link">Validation Errors</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#find-documents" class="sidebar-link">Find Documents</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#update-documents" class="sidebar-link">Update Documents</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#remove-documents" class="sidebar-link">Remove Documents</a></li></ul></li><li><a href="/guides/ottoman-couchbase.html#middleware" class="sidebar-link">Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#available-hooks" class="sidebar-link">Available Hooks</a></li></ul></li><li><a href="/guides/ottoman-couchbase.html#query-building" class="sidebar-link">Query Building</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#parameters" class="sidebar-link">Parameters</a></li><li class="sidebar-sub-header"><a href="/guides/ottoman-couchbase.html#mixed-mode" class="sidebar-link">Mixed Mode</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ottoman-for-couchbase-node-js-sdk-developers"><a href="#ottoman-for-couchbase-node-js-sdk-developers" class="header-anchor">#</a> Ottoman for Couchbase Node.js SDK developers</h1> <p><a href="/guides/ottoman.html">Ottoman</a> is an Object Data Modeler (ODM) for Couchbase’s Node.js SDK providing JSON schema and validation for NoSQL.</p> <h2 id="why-use-an-odm-for-couchbase"><a href="#why-use-an-odm-for-couchbase" class="header-anchor">#</a> Why Use an ODM for Couchbase</h2> <p>With Ottoman, you declare <a href="/guides/schema.html">schema</a> in your code. Although Couchbase has no schema enforcement for your documents, most applications need some level of schema even in NoSQL. We will explore how to achieve <code>schema</code> and validation in NoSQL using Ottoman and Couchbase.</p> <p>It’s important to validate that documents meet certain requirements before persisting. Although Ottoman creates an abstraction over the Couchbase SDK, the benefits outweigh the drawbacks. A developer creates a lot of logic around creating and updating documents, writing <em>pre/post</em> lifecycle, working with data structures, and validation.</p> <h2 id="nosql-database-and-schema-design"><a href="#nosql-database-and-schema-design" class="header-anchor">#</a> NoSQL Database and Schema Design</h2> <p>An ODM serves a similar role in NoSQL as it does in a relational database, but with additional benefits. Couchbase <em><strong>doesn’t</strong></em> enforce validation as it is schema-flexible. Ottoman can perform certain checks are being made as your applications persist data. We can warn and error against unwanted data types and formats for individual fields by defining schema and models for various document types.</p> <p>Your server application code is where a great place to apply business logic and validation. Ottoman’s goal is to provide a better development experience along with giving you control over schema and validation while using Couchbase with Node. We want to give developers a reliable tool to build systems that are easy to design, maintain, and scale.</p> <p><img src="/assets/img/ottoman-couchbase-node-sdk.9a07162f.jpg" alt="Ottoman Couchbase Node SDK"></p> <p>If you are familiar with Mongoose, an ODM for MongoDB, you will feel pretty comfortable with Ottoman as they have many overlapping features because they both are made for NodeJS and used to model and persist data to a JSON document-oriented key-value database.</p> <p>In Ottoman, we have many constructs to help define schema and models at the application level. Let’s go over some of the most important terms you need to know in Ottoman.</p> <div class="custom-block tip"><p class="custom-block-title">Couchbase document example:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hotel&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hotel Kabuki&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1625 Post Street&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;phones&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;321-208-4321&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;321-208-1234&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h2 id="types"><a href="#types" class="header-anchor">#</a> Types</h2> <p>Document properties with the name <code>type</code> in Couchbase are near equivalent to <strong>tables</strong> in a relational database. They can help to group different types of JSON documents together for indexing purposes. When using <strong>Secondary Indexes</strong> in Couchbase, we are able to index on any key in the documents. If only 100 of 10,000 documents in your database use a <code>type</code> of <em>‘hotel’</em>, and you normally want to search for <em>hotels</em> based on <em>city</em> or <em>state</em>, then you might want to build a <em>Composite Secondary Index</em> that only needs to search through those hundred documents where <em>city</em> or <em>state</em> equal a certain value. This is much more efficient than using, for instance, a <strong>Primary Index</strong>.</p> <h2 id="collections"><a href="#collections" class="header-anchor">#</a> Collections</h2> <p>Similar to <code>types</code> in Couchbase 6.x (latest Couchbase major version at the time of writing), <code>collections</code> will be favored in Couchbase 7 (<a href="https://www.couchbase.com/downloads" target="_blank" rel="noopener noreferrer">already in beta<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>). In the case you were to use <code>collections</code>, you would simply not have a <code>type</code> property on each document and instead have the document assigned to a <em><strong>‘hotel’</strong></em> <code>collection</code>.</p> <h2 id="documents"><a href="#documents" class="header-anchor">#</a> Documents</h2> <p><a href="/guides/document.html">Documents</a> are comparable to rows of data in a relational database. Traditional RDBMS systems will reference related documents from other tables. You can also do this with a JSON document, however it is suggested to include that information as an embedded document when possible, as we see with the <em><strong>hotel</strong></em> document’s <code>phone</code> number property which is an array of phone numbers. Albeit a very simple example of this, think if you had an <code>address</code> property that itself was another JSON object with many properties, you may think this needs to be given its own document, but nesting that information in the parent document in most cases is fine.</p> <h2 id="fields"><a href="#fields" class="header-anchor">#</a> Fields</h2> <p>Also known as attributes, are similar to columns in a relational database and with Ottoman, you can create field-level requirements as part of your schema.</p> <h2 id="schema"><a href="#schema" class="header-anchor">#</a> Schema</h2> <p>While Couchbase is schema-less or schema-flexible, we can still enforce structure at the application level for our documents with <a href="/guides/schema.html">Schemas</a>.</p> <h2 id="model"><a href="#model" class="header-anchor">#</a> Model</h2> <p><a href="/guides/model.html">Model</a> is a constructor method that takes a <code>schema</code> and creates an instance of a <code>document</code> equivalent to a single record in a relational database. This <em>document instance</em> can be constructed and then persisted to Couchbase by Ottoman <a href="/guides/model.html#constructing-documents">using the <code>save()</code> method</a>.</p> <h2 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h2> <p>Let’s get started creating a demo application that we can use to get familiar with Ottoman as an object document mapper.</p> <h3 id="couchbase-installation"><a href="#couchbase-installation" class="header-anchor">#</a> Couchbase Installation</h3> <p>Before we get started, let’s set up Couchbase.</p> <p>You can choose from <strong>one of the following options</strong> (we will be using the first option):</p> <ol><li><a href="https://developer.couchbase.com/docker-image-manual-cb65/" target="_blank" rel="noopener noreferrer">Install Couchbase Server using Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Download Couchbase specific for your OS from the <a href="https://www.couchbase.com/downloads" target="_blank" rel="noopener noreferrer">Couchbase Website<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <p>Let’s navigate through some basics of Ottoman by implementing a model that represents data for a simplified airline example keeping in tradition with Couchbase’s <strong>Travel-Sample</strong> dataset.</p> <p>Need to have installed on your machine NodeJS and NPM. Next, we will create a blank project and get started writing some code.</p> <h3 id="initializing-our-project-with-npm"><a href="#initializing-our-project-with-npm" class="header-anchor">#</a> Initializing our Project with NPM</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Create directory, initialize project &amp; install Ottoman</span>
<span class="token operator">&gt;</span> <span class="token function">mkdir</span> intro-ottoman <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$_</span> <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> init -y <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> i ottoman <span class="token operator">&amp;&amp;</span> <span class="token function">touch</span> createAirline.js
</code></pre></div><p>Can use the IDE that is best to your liking and open the created directory <code>intro-ottoman/</code>.</p> <h3 id="connection-to-couchbase-with-ottoman"><a href="#connection-to-couchbase-with-ottoman" class="header-anchor">#</a> Connection to Couchbase with Ottoman</h3> <p>We will start working out of the file <code>./createAirline.js</code> under the project root and add the following (based on the default configuration):</p> <div class="custom-block tip"><p class="custom-block-title">Connecting to Couchbase in Ottoman</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Ottoman<span class="token punctuation">,</span> model<span class="token punctuation">,</span> Schema <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ottoman'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">{</span> collectionName<span class="token operator">:</span> <span class="token string">'_default'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  connectionString<span class="token operator">:</span> <span class="token string">'couchbase://localhost'</span><span class="token punctuation">,</span>
  bucketName<span class="token operator">:</span> <span class="token string">'travel'</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'password'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <p>Together this imports the <code>ottoman</code> package and specifies the <code>_default</code> <em><strong>collection</strong></em> (Couchbase Server 6.x style)</p> <h3 id="ottoman-schema-and-models"><a href="#ottoman-schema-and-models" class="header-anchor">#</a> Ottoman Schema and Models</h3> <p>Models are fancy constructors compiled from <a href="/guides/schema.html">Schema</a> definitions. An instance of a <code>model</code> is called a <code>document</code>. <a href="/guides/model.html">Models</a> in Ottoman help you to easily <em>create</em>, <em>read</em>, <em>update</em>, and <em>delete</em> documents in your Couchbase database.</p> <p>Creating an Ottoman <code>model</code> comprises a few things:</p> <h3 id="defining-a-document-schema"><a href="#defining-a-document-schema" class="header-anchor">#</a> Defining a Document Schema</h3> <p>A <code>schema</code> defines <code>document</code> properties through an object where the key name corresponds to the property name in the <code>collection</code>.</p> <div class="custom-block tip"><p class="custom-block-title">Create an Airline Schema</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> airlineSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  callsign<span class="token operator">:</span> String<span class="token punctuation">,</span>
  country<span class="token operator">:</span> String<span class="token punctuation">,</span>
  name<span class="token operator">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <p>Here we define three properties <strong>(callsign, country, name)</strong> within our <code>schema</code>, all of type <code>String</code>. By specifying a <code>type</code> for each of our <code>model</code> properties, maps to an internal validator that will be triggered when the <code>model</code> is saved to the database and fail if the data type of the value is not of type <code>String</code>.</p> <p>The following <a href="">Schema Types</a> are permitted:</p> <ul><li><a href="/classes/schema.html#string">String</a></li> <li><a href="/classes/schema.html#number">Number</a></li> <li><a href="/classes/schema.html#array">Array</a></li> <li><a href="/classes/schema.html#boolean">Boolean</a></li> <li><a href="/classes/schema.html#date">Date</a></li> <li><a href="/classes/embedtype.html">EmbedType</a></li> <li><a href="/classes/mixedtype.html">MixedType</a></li> <li><a href="/classes/referencetype.html">ReferenceTypes</a></li></ul> <h3 id="defining-a-document-model"><a href="#defining-a-document-model" class="header-anchor">#</a> Defining a Document Model</h3> <p>We need to call the <code>model</code> constructor on the <code>ottoman</code> instance and pass it the name of the <code>collection</code> and a reference to the <code>schema</code> definition.</p> <div class="custom-block tip"><p class="custom-block-title">Create Airline Model</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Airline <span class="token operator">=</span> ottoman<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Airline'</span><span class="token punctuation">,</span> airlineSchema<span class="token punctuation">)</span>
</code></pre></div></div> <p>When you call the <a href="/classes/ottoman.html#model"><code>model()</code></a> function it creates a copy of the <code>schema</code> and compiles the <code>model</code> for you.</p> <p>Let’s also give the <code>airlineSchema</code> a <em><strong>phone number</strong></em> property. We can add a validation function that will ensure that the value is a valid phone number. Replace the <code>airlineSchema</code> section with these three blocks of code:</p> <div class="custom-block tip"><p class="custom-block-title">Add Validator to Airline Schema</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> regx <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(\([0-9]{3}\)|[0-9]{3}-)[0-9]{3}-[0-9]{4}$</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> value <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>value<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regx<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Phone Number </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> value <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not valid</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">addValidators</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  phone<span class="token operator">:</span> phoneValidator
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> airlineSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  callsign<span class="token operator">:</span> String<span class="token punctuation">,</span>
  country<span class="token operator">:</span> String<span class="token punctuation">,</span>
  name<span class="token operator">:</span> String<span class="token punctuation">,</span>
  phone<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> validator<span class="token operator">:</span> <span class="token string">'phone'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>In the example above, wee see how to create a custom <code>validator</code>, we just happen to be using a regular expression as the check-in our validator, just understand that you could have any logic inside one of these validators and in a moment will show you a nice trick to reduce our code down considering we are using regular expression for our matching of the phone numbers.</p> <h3 id="defining-validators"><a href="#defining-validators" class="header-anchor">#</a> Defining Validators</h3> <p><a href="">Validators</a> registered with Ottoman (as we have done here with the <code>ottoman.addValidators()</code> method) will be called once for every value our document’s property has in the array. If the property did not have an array and instead just a single <em>String</em> value, the validator would only be run once. For this reason, I print out the problematic phone number if the validation fails.</p> <p>There is however an easier way to validate any document properties value so long as the check you are performing uses a regular expression. The <a href="/interfaces/validatoroption.html#hierarchy'">ValidatorOption</a> can take a regexp and message as an argument, so we can reduce our code down to:</p> <div class="custom-block tip"><p class="custom-block-title">Update Schema to use Validator</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> regx <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(\([0-9]{3}\)|[0-9]{3}-)[0-9]{3}-[0-9]{4}$</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">const</span> airlineSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  callsign<span class="token operator">:</span> String<span class="token punctuation">,</span>
  country<span class="token operator">:</span> String<span class="token punctuation">,</span>
  name<span class="token operator">:</span> String<span class="token punctuation">,</span>
  phone<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> validator<span class="token operator">:</span> <span class="token punctuation">{</span> regexp<span class="token operator">:</span> regx<span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'phone invalid'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>As you can see, we can do everything we were doing before inline when creating a new <code>Schema</code>. But don’t let this keep you from understanding how to create a custom validator, sometimes we need additional logic and that is why the first example is still something worth knowing.</p> <h2 id="basic-document-operations-in-nosql"><a href="#basic-document-operations-in-nosql" class="header-anchor">#</a> Basic Document Operations in NoSQL</h2> <p>Most of the basic operations are covered in our Ottoman V2 documentation, we will cover some of that here, but feel free to dive into our <a href="/" class="router-link-active">Ottoman V2 (alpha)</a> docs and let us know if there is something that you cannot find or don’t understand.</p> <h3 id="create-documents"><a href="#create-documents" class="header-anchor">#</a> Create Documents</h3> <p>Considering the code that we already went over above that creates a <code>schema</code>, <code>model</code>, and <code>validators</code>. <em>Saving</em> a <code>model</code> and <em>persisting</em> it to the database is quite easy. Let’s create a new <strong>Airline</strong> <code>model</code> using our <code>Schema</code> and then <em>save/persist</em> it to the database.</p> <div class="custom-block tip"><p class="custom-block-title">Create Document &amp; Save to Couchbase</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Constructing our document</span>
<span class="token keyword">const</span> cbAirlines <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Airline</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  callsign<span class="token operator">:</span> <span class="token string">'CBA'</span><span class="token punctuation">,</span>
  country<span class="token operator">:</span> <span class="token string">'United States'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Couchbase Airlines'</span><span class="token punctuation">,</span>
  phone<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'321-321-3210'</span><span class="token punctuation">,</span> <span class="token string">'321-123-1234'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Persist the Couchbase Airlines document to Couchbase Server</span>
<span class="token keyword">const</span> <span class="token function-variable function">saveDocument</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> cbAirlines<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ensure that all indexes exist on the server</span>
ottoman<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Next, let's save our document and print a success message </span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">saveDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>You may be wondering why we don’t just call the <code>save()</code> Document function on its own. Instead, we call it after the <code>ottoman.start()</code> is finished. The start method is a shortcut to run <code>ensureCollections</code> and <code>ensureIndexes</code>. All you have to know for now is that this method makes sure that the proper Ottoman-related indexes have been created on Couchbase and this is important to ensure we can run things like the <code>find()</code> method and use tools like the <a href="">QueryBuilder</a> which we will get to at the end of the article.</p> <p>At this point, if you were to run all of the code we have written using Node, our <code>document</code> would be saved to the database:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Run createAirline with Node</span>
<span class="token operator">&gt;</span> node createAirline.js
</code></pre></div><p>The result from this operation:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Result of Save Airline</span>
_Model <span class="token punctuation">{</span>
  callsign: <span class="token string">'CBA'</span>,
  country: <span class="token string">'United States'</span>,
  name: <span class="token string">'Couchbase Airlines'</span>,
  phone: <span class="token punctuation">[</span><span class="token string">'321-321-3210'</span>, <span class="token string">'321-123-1234'</span><span class="token punctuation">]</span>,
  id: <span class="token string">'2384568f-f1e9-446e-97d1-cad697c40e76'</span>,
  _type: <span class="token string">'Airline'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The following fields are returned:</p> <ol><li><code>callsign</code>, <code>country</code>, and <code>name</code> fields are all <code>String</code>, the most basic value we could have in a <code>document</code>.</li> <li><code>id</code> field is auto-generated by Couchbase and is a <strong>unique key</strong>. The <em><strong>ID</strong></em> value is what you will use in any case to find a <code>document</code> with Ottoman in methods like <a href="">findById</a> or <a href="">removeById</a></li> <li><code>phone</code> field is represented by an array and contains valid <em>phone numbers</em>.</li> <li><code>_type</code> field can help us to organize our documents like a table does in a relational database, in Couchbase 7, we can use <code>collections</code> and <code>scopes</code>.</li></ol> <h3 id="validation-errors"><a href="#validation-errors" class="header-anchor">#</a> Validation Errors</h3> <p>If we enter an invalid phone number and run node <code>createAirline.js</code> this file again, we would get an error message:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Result of Validation Error</span>
ValidationError: Phone Number <span class="token number">321</span>-321-32xx is not valid
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Export Schema and Model</p> <p>You can define your <em>connection</em>, <em>schema</em>, and <em>models</em> in separate files, export, and use them in other files. Create a new file named <code>airline-schema-model.js</code> and move our <code>schema</code> and <code>model</code> definition to it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> model<span class="token punctuation">,</span> Schema <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ottoman'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> regx <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(\([0-9]{3}\)|[0-9]{3}-)[0-9]{3}-[0-9]{4}$</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">const</span> airlineSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  callsign<span class="token operator">:</span> String<span class="token punctuation">,</span>
  country<span class="token operator">:</span> String<span class="token punctuation">,</span>
  name<span class="token operator">:</span> String<span class="token punctuation">,</span>
  phone<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> validator<span class="token operator">:</span> <span class="token punctuation">{</span> regexp<span class="token operator">:</span> regx<span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'phone invalid'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Compile our model using our schema</span>
<span class="token keyword">const</span> Airline <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Airline'</span><span class="token punctuation">,</span> airlineSchema<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span>airlineSchema <span class="token operator">=</span> airlineSchema<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>Airline <span class="token operator">=</span> Airline<span class="token punctuation">;</span>
</code></pre></div></div> <p>Now we can create a few new files, <code>findAirline.js</code>, <code>updateAirline.js</code>, and <code>removeAirline.js</code> and populate each file with the following:</p> <div class="custom-block tip"><p class="custom-block-title">Boilerplate for Multiple Files</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ottoman'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">{</span> collectionName<span class="token operator">:</span> <span class="token string">'_default'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  connectionString<span class="token operator">:</span> <span class="token string">'couchbase://localhost'</span><span class="token punctuation">,</span>
  bucketName<span class="token operator">:</span> <span class="token string">'travel'</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'password'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> Airline <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./airline-schema-and-model'</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>This will help us to separate some of our code so we are not repeating it in each file and as we go over each of the CRUD operations we can just add some code to each file and our <code>schema</code> and <code>model</code> will already be imported.</p> <h3 id="find-documents"><a href="#find-documents" class="header-anchor">#</a> Find Documents</h3> <p>Let’s try to retrieve the record we saved to the database earlier. The <a href="/classes/model.html">model class</a> exposes several static and instance methods to perform operations on the database. We will now try to find the record that we created previously using the find method and pass the <code>callsign</code> as the search term. Let’s create a new file named <code>findAirline.js</code> and we can add the following code:</p> <div class="custom-block tip"><p class="custom-block-title">Find Airline Document by `callsign`</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Find the Couchbase Airline document by Callsign from Couchbase Server</span>
<span class="token keyword">const</span> <span class="token function-variable function">findDocument</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    Airline<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> callsign<span class="token operator">:</span> <span class="token punctuation">{</span> $like<span class="token operator">:</span> <span class="token string">'CBA'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ottoman<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">findDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>Find document result:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Result of Find Airline by 'callsign'</span>
<span class="token punctuation">[</span>
  _Model <span class="token punctuation">{</span>
    _type: <span class="token string">'Airline'</span>,
    callsign: <span class="token string">'CBA'</span>,
    country: <span class="token string">'United States'</span>,
    name: <span class="token string">'Couchbase Airlines'</span>,
    phone: <span class="token punctuation">[</span><span class="token string">'321-321-3210'</span>, <span class="token string">'321-123-1234'</span><span class="token punctuation">]</span>,
    id: <span class="token string">'971045ac-39d8-4e72-8c93-fdaac69aae31'</span>,
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="update-documents"><a href="#update-documents" class="header-anchor">#</a> Update Documents</h3> <p>Let’s modify the record above by finding it using the <code>callsign</code>, which we can assume that <code>callsign</code> will be a unique field in our data, then we can update the <code>document</code> all in a single operation.</p> <div class="custom-block tip"><p class="custom-block-title">Find Airline Document and Update</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Update the Couchbase Airline document by Callsign from Couchbase Server</span>
<span class="token keyword">const</span> <span class="token function-variable function">findDocumentAndUpdate</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newDocument <span class="token operator">=</span> <span class="token punctuation">{</span>
    callsign<span class="token operator">:</span> <span class="token string">'CBSA'</span><span class="token punctuation">,</span>
    country<span class="token operator">:</span> <span class="token string">'United States'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Couchbase Airways'</span><span class="token punctuation">,</span>
    phone<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'321-321-3210'</span><span class="token punctuation">,</span> <span class="token string">'321-123-1234'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Airline<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span> callsign<span class="token operator">:</span> <span class="token punctuation">{</span> $like<span class="token operator">:</span> <span class="token string">'CBA'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// filter</span>
      newDocument<span class="token punctuation">,</span> <span class="token comment">// data to update</span>
      <span class="token punctuation">{</span> <span class="token keyword">new</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token comment">// find options</span>
    <span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ottoman<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">findDocumentAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>Find document and update result:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Result of Find Airline Document and Update</span>
_Model <span class="token punctuation">{</span>
  _type: <span class="token string">'Airline'</span>,
  callsign: <span class="token string">'CBSA'</span>,
  country: <span class="token string">'United States'</span>,
  id: <span class="token string">'971045ac-39d8-4e72-8c93-fdaac69aae31'</span>,
  name: <span class="token string">'Couchbase Airways'</span>,
  phone: <span class="token punctuation">[</span><span class="token string">'321-321-3210'</span>, <span class="token string">'321-123-1234'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="remove-documents"><a href="#remove-documents" class="header-anchor">#</a> Remove Documents</h3> <p>Ottoman has several methods that deal with removing documents: <a href="/classes/document.html#remove">remove</a>, <a href="/interfaces/imodel.html#removebyid">removeById</a> and <a href="/interfaces/imodel.html#removemany">removeMany</a>. Considering the many examples we have had so far, each of these should be very easy to understand how to use, so we will just provide a simple example here to show how to remove a <code>document</code> that we have already found using the <a href="/interfaces/imodel.html#find">find</a> method.</p> <div class="custom-block tip"><p class="custom-block-title">Remove Airline Document by ID</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Remove the Couchbase Airline document by ID from Couchbase Server</span>
<span class="token keyword">const</span> <span class="token function-variable function">removeDocument</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> Airline<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span><span class="token string">'60e3f517-6a2a-41fe-be45-97081181d675'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <p>Remove <code>document</code> result is a simple <a href="https://docs.couchbase.com/nodejs-sdk/current/howtos/concurrent-document-mutations.html" target="_blank" rel="noopener noreferrer">cas value<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, used to track changes in Couchbase documents.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Result of Remove Airline Document by ID</span>
<span class="token punctuation">{</span> cas: CbCas <span class="token punctuation">{</span> <span class="token string">'0'</span><span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>Buffer 00 00 2e <span class="token number">30</span> <span class="token number">62</span> db 6c <span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h2> <p>We have already seen our middleware in action, our <code>validator</code> that we initially created can take advantage of middleware using functions that run at specific stages of a pipeline passing control during the execution of asynchronous functions.</p> <h3 id="available-hooks"><a href="#available-hooks" class="header-anchor">#</a> <a href="/guides/schema.html#hooks">Available Hooks</a></h3> <ul><li>validate</li> <li>save</li> <li>update</li> <li>remove</li></ul> <p>Example of Middleware (a.k.a. <a href="/guides/schema.html#register-hooks-with-pre">pre</a> and <a href="/guides/schema.html#post-hooks">post</a> hooks)</p> <p>Let’s try an example by simply generating a log in the console before and after the creation (<code>save</code>) of a <code>document</code>, We are going to create a new file called <code>createWithHooks.js</code> and most of the code will look familiar except we have added <code>pre</code> and <code>post</code> hooks that will just report to us the document <code>name</code> <em><strong>pre-save</strong></em> and document <code>id</code> <em><strong>post-save</strong></em>:</p> <div class="custom-block tip"><p class="custom-block-title">Create Document with Pre/Post Save Hooks</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ottoman'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">{</span> collectionName<span class="token operator">:</span> <span class="token string">'_default'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  connectionString<span class="token operator">:</span> <span class="token string">'couchbase://localhost'</span><span class="token punctuation">,</span>
  bucketName<span class="token operator">:</span> <span class="token string">'travel'</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'password'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> Airline<span class="token punctuation">,</span> airlineSchema <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./airline-schema-and-model'</span><span class="token punctuation">)</span>

<span class="token comment">// Plugins and Hooks are middleware, think lifecycle hooks!</span>
<span class="token keyword">const</span> <span class="token function-variable function">pluginLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">airlineSchema</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  airlineSchema<span class="token punctuation">.</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token string">'save'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Doc: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> doc<span class="token punctuation">.</span>name <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> about to be saved</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  airlineSchema<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'save'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Doc: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> doc<span class="token punctuation">.</span>id <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> has been saved</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Our plugin must be registered before the model creation</span>
airlineSchema<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>pluginLog<span class="token punctuation">)</span>

<span class="token comment">// Constructing our document</span>
<span class="token keyword">const</span> cbAirlines <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Airline</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  callsign<span class="token operator">:</span> <span class="token string">'UNITED'</span><span class="token punctuation">,</span>
  country<span class="token operator">:</span> <span class="token string">'United States'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'United Airlines'</span><span class="token punctuation">,</span>
  phone<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'321-321-3210'</span><span class="token punctuation">,</span> <span class="token string">'321-123-1234'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">saveDocument</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// pre and post hooks will run</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> cbAirlines<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ottoman<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">saveDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>Save document result:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Result Save Airline Document</span>
Doc: United Airlines about to be saved
Doc: 1316488a-98ba-4dbb-b0d7-ea6001a0bf57 has been saved
_Model <span class="token punctuation">{</span>
  callsign: <span class="token string">'UNITED'</span>,
  country: <span class="token string">'United States'</span>,
  name: <span class="token string">'United Airlines'</span>,
  phone: <span class="token punctuation">[</span><span class="token string">'321-321-3210'</span>, <span class="token string">'321-123-1234'</span><span class="token punctuation">]</span>,
  id: <span class="token string">'1316488a-98ba-4dbb-b0d7-ea6001a0bf57'</span>,
  _type: <span class="token string">'Airline'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We got our messages before and after the save. With validation, you can ensure certain <code>document</code> property values meet your criteria. Tapping into the lifecycle when the <code>document</code> is saved, updated, and removed also helped us gain a handle on Ottoman middleware!</p> <h2 id="query-building"><a href="#query-building" class="header-anchor">#</a> Query Building</h2> <p>Ottoman has a very rich API that handles many complex operations supported by Couchbase and N1QL. Our query builder behind the scenes creates your N1QL statements for you. When using <a href="/guides/query-builder.html#using-the-query-builder">Query Builder</a> you have three options of which mode to use.</p> <ol><li><a href="/guides/query-builder.html#build-a-query-by-using-parameters">Using parameters</a></li> <li><a href="/guides/query-builder.html#build-a-query-by-using-access-functions">Using Access Functions</a></li> <li><a href="/guides/query-builder.html#build-a-query-by-using-parameters-and-function-parameters">Using parameters and Access Functions</a></li></ol> <p>In the next three examples, we will do the same thing using each of the three different <code>QueryBuilder</code> modes (<em>params</em>, <em>access functions</em>, and <em>mixed-mode</em>). Each example will:</p> <blockquote><ul><li><p><em>Select</em> <code>name</code> and <code>country</code> from <em><strong>Airline</strong></em></p></li> <li><p><em>Where</em> the <code>country</code> value is “United States”</p></li> <li><p>And <em>LIMIT</em> our results to 10</p></li></ul></blockquote> <p>Let’s first create a new file named <code>findWithQueryBuilder.js</code>, and add the following code:</p> <div class="custom-block tip"><p class="custom-block-title">Find Airline Document with QueryBuilder</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Ottoman<span class="token punctuation">,</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ottoman'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">{</span> collectionName<span class="token operator">:</span> <span class="token string">'_default'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  connectionString<span class="token operator">:</span> <span class="token string">'couchbase://localhost'</span><span class="token punctuation">,</span>
  bucketName<span class="token operator">:</span> <span class="token string">'travel'</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'password'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Replace with QueryBuilder Example */</span>

<span class="token keyword">const</span> <span class="token function-variable function">executeQuery</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Query Result: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">generateQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">executeQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <p>This file has a comment in the middle that says: ***“Replace with QueryBuilder Example”***. We can just copy any of the following examples in this section into that area of the file.</p> <h3 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h3> <div class="custom-block tip"><p class="custom-block-title">Demonstrate Query Builder using Parameters</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">generateQuery</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
      select<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> $field<span class="token operator">:</span> <span class="token string">'name'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> $field<span class="token operator">:</span> <span class="token string">'country'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      where<span class="token operator">:</span> <span class="token punctuation">{</span>
        $and<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> country<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token string">'United States'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> _type<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token string">'Airline'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      limit<span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token string">'`travel`'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Query Generated: '</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>
    <span class="token keyword">return</span> query
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h3 id="mixed-mode"><a href="#mixed-mode" class="header-anchor">#</a> Mixed Mode</h3> <div class="custom-block tip"><p class="custom-block-title">Demonstrate Query Builder using Mixed Mode (Parameters &amp; Access Functions)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">generateQuery</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> where <span class="token operator">=</span> <span class="token punctuation">{</span>
      $and<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> country<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token string">'United States'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> _type<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token string">'Airline'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// pass in our query as a condition expression</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'`travel`'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span> $field<span class="token operator">:</span> <span class="token string">'name'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> $field<span class="token operator">:</span> <span class="token string">'country'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Query Generated: '</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>
    <span class="token keyword">return</span> query
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <p>Once you have created a <code>generateQuery()</code> function using one of the mixed modes above, you would then need to asynchronously call <code>generateQuery</code> and <code>executeQuery</code> and the code for that will work with many flavors of the above code:</p> <p>A result from any of the three modes above:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Result of Find Airline Document with QueryBuilder</span>
Query Generated:  SELECT name,country FROM <span class="token variable"><span class="token variable">`</span>travel<span class="token variable">`</span></span> WHERE <span class="token punctuation">(</span>country<span class="token operator">=</span><span class="token string">&quot;United States&quot;</span> AND <span class="token assign-left variable">_type</span><span class="token operator">=</span><span class="token string">&quot;Airline&quot;</span><span class="token punctuation">)</span> LIMIT <span class="token number">10</span>
Query Result:  <span class="token punctuation">{</span>
  meta: <span class="token punctuation">{</span>
    requestId: <span class="token string">'1514fa20-755e-49b3-bbfa-4ed75a1a40ee'</span>,
    clientContextId: <span class="token string">'0334862c79e727f8'</span>,
    status: <span class="token string">'success'</span>,
    signature: <span class="token punctuation">{</span> country: <span class="token string">'json'</span>, name: <span class="token string">'json'</span> <span class="token punctuation">}</span>,
    profile: undefined,
    metrics: <span class="token punctuation">{</span>
      elapsedTime: <span class="token number">6.219</span>,
      executionTime: <span class="token number">5.9619</span>,
      sortCount: undefined,
      resultCount: <span class="token number">2</span>,
      resultSize: <span class="token number">106</span>,
      mutationCount: undefined,
      errorCount: undefined,
      warningCount: undefined
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  rows: <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> country: <span class="token string">'United States'</span>, name: <span class="token string">'United Airlines'</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span> country: <span class="token string">'United States'</span>, name: <span class="token string">'Jet Blue Airlines'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f67cace5.js" defer></script><script src="/assets/js/2.91685ef8.js" defer></script><script src="/assets/js/8.dbb9107b.js" defer></script>
  </body>
</html>
