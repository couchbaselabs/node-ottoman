<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ottoman Class | Ottoman.js</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Ottoman is an ODM built for Couchbase and Node.js. ">
    
    <link rel="preload" href="/assets/css/0.styles.40ca5c7f.css" as="style"><link rel="preload" href="/assets/js/app.ec664b64.js" as="script"><link rel="preload" href="/assets/js/2.292e99e5.js" as="script"><link rel="preload" href="/assets/js/9.d862ec66.js" as="script"><link rel="prefetch" href="/assets/js/10.504dc392.js"><link rel="prefetch" href="/assets/js/100.dee01a8c.js"><link rel="prefetch" href="/assets/js/101.bd4c90f2.js"><link rel="prefetch" href="/assets/js/102.0d41ac6e.js"><link rel="prefetch" href="/assets/js/11.dbc6e61a.js"><link rel="prefetch" href="/assets/js/12.656cf546.js"><link rel="prefetch" href="/assets/js/13.506108c0.js"><link rel="prefetch" href="/assets/js/14.4fe84632.js"><link rel="prefetch" href="/assets/js/15.acf36e9f.js"><link rel="prefetch" href="/assets/js/16.b6a2ced4.js"><link rel="prefetch" href="/assets/js/17.ebffbdf0.js"><link rel="prefetch" href="/assets/js/18.90390515.js"><link rel="prefetch" href="/assets/js/19.d310a4a6.js"><link rel="prefetch" href="/assets/js/20.9410f2bf.js"><link rel="prefetch" href="/assets/js/21.db28559f.js"><link rel="prefetch" href="/assets/js/22.5692e2d0.js"><link rel="prefetch" href="/assets/js/23.45c6a9b2.js"><link rel="prefetch" href="/assets/js/24.232e349c.js"><link rel="prefetch" href="/assets/js/25.cdf89a9b.js"><link rel="prefetch" href="/assets/js/26.ca43aa42.js"><link rel="prefetch" href="/assets/js/27.bfd5b69b.js"><link rel="prefetch" href="/assets/js/28.1166e0fb.js"><link rel="prefetch" href="/assets/js/29.9ada5f55.js"><link rel="prefetch" href="/assets/js/3.49d3580b.js"><link rel="prefetch" href="/assets/js/30.35db8619.js"><link rel="prefetch" href="/assets/js/31.90e23d5f.js"><link rel="prefetch" href="/assets/js/32.1d63a210.js"><link rel="prefetch" href="/assets/js/33.a2253ca5.js"><link rel="prefetch" href="/assets/js/34.41609780.js"><link rel="prefetch" href="/assets/js/35.cface84c.js"><link rel="prefetch" href="/assets/js/36.3f616d52.js"><link rel="prefetch" href="/assets/js/37.01c386d1.js"><link rel="prefetch" href="/assets/js/38.fd77e8a6.js"><link rel="prefetch" href="/assets/js/39.34c2e03e.js"><link rel="prefetch" href="/assets/js/4.73090f3f.js"><link rel="prefetch" href="/assets/js/40.57a929e1.js"><link rel="prefetch" href="/assets/js/41.fa4ddeb9.js"><link rel="prefetch" href="/assets/js/42.ac56c8d9.js"><link rel="prefetch" href="/assets/js/43.52282a19.js"><link rel="prefetch" href="/assets/js/44.fdd8375e.js"><link rel="prefetch" href="/assets/js/45.6c053380.js"><link rel="prefetch" href="/assets/js/46.1f6515b0.js"><link rel="prefetch" href="/assets/js/47.7dcfa7b8.js"><link rel="prefetch" href="/assets/js/48.d3838243.js"><link rel="prefetch" href="/assets/js/49.dca17b16.js"><link rel="prefetch" href="/assets/js/5.1593dc86.js"><link rel="prefetch" href="/assets/js/50.296712b4.js"><link rel="prefetch" href="/assets/js/51.0baecbba.js"><link rel="prefetch" href="/assets/js/52.a877180f.js"><link rel="prefetch" href="/assets/js/53.27a8b626.js"><link rel="prefetch" href="/assets/js/54.8e09d763.js"><link rel="prefetch" href="/assets/js/55.defc1916.js"><link rel="prefetch" href="/assets/js/56.bc5cca2f.js"><link rel="prefetch" href="/assets/js/57.38bc7024.js"><link rel="prefetch" href="/assets/js/58.92731a2c.js"><link rel="prefetch" href="/assets/js/59.ef8b4fa3.js"><link rel="prefetch" href="/assets/js/6.2ea56376.js"><link rel="prefetch" href="/assets/js/60.cbc767fa.js"><link rel="prefetch" href="/assets/js/61.de4e745a.js"><link rel="prefetch" href="/assets/js/62.5f2813cd.js"><link rel="prefetch" href="/assets/js/63.e5531655.js"><link rel="prefetch" href="/assets/js/64.c90323d4.js"><link rel="prefetch" href="/assets/js/65.fedfe7cb.js"><link rel="prefetch" href="/assets/js/66.69a4cb9b.js"><link rel="prefetch" href="/assets/js/67.795d35e2.js"><link rel="prefetch" href="/assets/js/68.98e84a8a.js"><link rel="prefetch" href="/assets/js/69.549d98e2.js"><link rel="prefetch" href="/assets/js/7.5c4067f0.js"><link rel="prefetch" href="/assets/js/70.c9968aeb.js"><link rel="prefetch" href="/assets/js/71.a621440e.js"><link rel="prefetch" href="/assets/js/72.912346b4.js"><link rel="prefetch" href="/assets/js/73.28f246c2.js"><link rel="prefetch" href="/assets/js/74.6b7f437b.js"><link rel="prefetch" href="/assets/js/75.fd272c32.js"><link rel="prefetch" href="/assets/js/76.d59565ff.js"><link rel="prefetch" href="/assets/js/77.855bf45a.js"><link rel="prefetch" href="/assets/js/78.48c51c0e.js"><link rel="prefetch" href="/assets/js/79.394984f8.js"><link rel="prefetch" href="/assets/js/8.53269ba7.js"><link rel="prefetch" href="/assets/js/80.f9fbe652.js"><link rel="prefetch" href="/assets/js/81.544ebdb0.js"><link rel="prefetch" href="/assets/js/82.c6abbbd3.js"><link rel="prefetch" href="/assets/js/83.ed29d4e8.js"><link rel="prefetch" href="/assets/js/84.45a9d7de.js"><link rel="prefetch" href="/assets/js/85.84c4b73d.js"><link rel="prefetch" href="/assets/js/86.45ccdf41.js"><link rel="prefetch" href="/assets/js/87.d7d26f83.js"><link rel="prefetch" href="/assets/js/88.b2f8df28.js"><link rel="prefetch" href="/assets/js/89.164205ea.js"><link rel="prefetch" href="/assets/js/90.bbfd6c1c.js"><link rel="prefetch" href="/assets/js/91.4854698e.js"><link rel="prefetch" href="/assets/js/92.8d7369a9.js"><link rel="prefetch" href="/assets/js/93.007e472c.js"><link rel="prefetch" href="/assets/js/94.eb404006.js"><link rel="prefetch" href="/assets/js/95.0b8a00b9.js"><link rel="prefetch" href="/assets/js/96.65be5c91.js"><link rel="prefetch" href="/assets/js/97.3146122a.js"><link rel="prefetch" href="/assets/js/98.52c7210d.js"><link rel="prefetch" href="/assets/js/99.6dc4fdfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.40ca5c7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ottoman.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/faq.html" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" class="nav-link">
  How Ottoman Works
</a></li><li class="dropdown-item"><!----> <a href="/advanced/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/mongoose-to-couchbase.html" class="nav-link">
  Mongoose to Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottoman-couchbase.html" class="nav-link">
  Ottoman for Couchbase Node.js SDK devs
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottomanV1-to-ottomanV2.html" class="nav-link">
  Ottoman V1 to Ottoman V2
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guides/faq.html" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/guides/quick-start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic" class="dropdown-title"><span class="title">Basic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic" class="mobile-dropdown-title"><span class="title">Basic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/ottoman.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/guides/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/guides/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/guides/query-builder.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Advanced" class="dropdown-title"><span class="title">Advanced</span> <span class="arrow down"></span></button> <button type="button" aria-label="Advanced" class="mobile-dropdown-title"><span class="title">Advanced</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/how-ottoman-works.html" class="nav-link">
  How Ottoman Works
</a></li><li class="dropdown-item"><!----> <a href="/advanced/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/mongoose-to-couchbase.html" class="nav-link">
  Mongoose to Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottoman-couchbase.html" class="nav-link">
  Ottoman for Couchbase Node.js SDK devs
</a></li><li class="dropdown-item"><!----> <a href="/guides/ottomanV1-to-ottomanV2.html" class="nav-link">
  Ottoman V1 to Ottoman V2
</a></li></ul></div></div><div class="nav-item"><a href="/guides/first-app.html" class="nav-link">
  Example
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API" class="dropdown-title"><span class="title">API</span> <span class="arrow down"></span></button> <button type="button" aria-label="API" class="mobile-dropdown-title"><span class="title">API</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/classes/ottoman.html" class="nav-link">
  Ottoman
</a></li><li class="dropdown-item"><!----> <a href="/classes/schema.html" class="nav-link">
  Schema
</a></li><li class="dropdown-item"><!----> <a href="/classes/model.html" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/classes/document.html" class="nav-link">
  Document
</a></li><li class="dropdown-item"><!----> <a href="/classes/query.html" class="nav-link">
  Query Builder
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/couchbaselabs/node-ottoman" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ottoman Class</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guides/ottoman.html#defining-an-ottoman-instance" class="sidebar-link">Defining an Ottoman Instance</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#ottoman-constructor-options" class="sidebar-link">Ottoman Constructor Options</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#connections" class="sidebar-link">Connections</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#create-a-connection" class="sidebar-link">Create a Connection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/ottoman.html#connection-string-anatomy" class="sidebar-link">Connection String Anatomy</a></li></ul></li><li><a href="/guides/ottoman.html#connection-options" class="sidebar-link">Connection Options</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#certificate-authentication" class="sidebar-link">Certificate Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/ottoman.html#authenticating-ottoman-by-certificate" class="sidebar-link">Authenticating Ottoman by Certificate</a></li></ul></li><li><a href="/guides/ottoman.html#default-ottoman-instance" class="sidebar-link">Default Ottoman Instance</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#using-the-standalone-functions" class="sidebar-link">Using the standalone functions</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#multiple-ottoman-instances" class="sidebar-link">Multiple Ottoman instances</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#closing-connections" class="sidebar-link">Closing Connections</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#not-using-scopes-collections" class="sidebar-link">Not Using Scopes/Collections</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#bootstrapping" class="sidebar-link">Bootstrapping</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#setting-environment-variables" class="sidebar-link">Setting Environment Variables</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#events" class="sidebar-link">Events</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/ottoman.html#event-indexonline" class="sidebar-link">Event IndexOnline</a></li></ul></li><li><a href="/guides/ottoman.html#helper-functions" class="sidebar-link">Helper Functions</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guides/ottoman.html#next-up" class="sidebar-link">Next Up</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ottoman-class"><a href="#ottoman-class" class="header-anchor">#</a> Ottoman Class</h1> <h2 id="defining-an-ottoman-instance"><a href="#defining-an-ottoman-instance" class="header-anchor">#</a> Defining an Ottoman Instance</h2> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./ottoman&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Ottoman's instances are the backbone of Ottoman.js and the entry point to use the ODM in your app.</p> <h2 id="ottoman-constructor-options"><a href="#ottoman-constructor-options" class="header-anchor">#</a> Ottoman Constructor Options</h2> <p>Ottoman allows you to modify it's settings, this is useful for database modeling or migration.
One example is changing the metadata key to define the model in your documents.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./ottoman&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  modelKey<span class="token operator">:</span> <span class="token string">'type'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The <code>modelKey</code> default value is set to <code>_type</code>, but maybe you want to change it to <code>type</code> as it's described in the example above.</p> <p>The available configurations are:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">OttomanConfig</span> <span class="token punctuation">{</span>
  collectionName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  scopeName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  idKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  modelKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  populateMaxDeep<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  consistency<span class="token operator">?</span><span class="token operator">:</span> SearchConsistency<span class="token punctuation">;</span>
  maxExpiry<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  keyGenerator<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> metadata<span class="token operator">:</span> ModelMetadata <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  keyGeneratorDelimiter<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>collectionName</code>: Store value to use for each Model if not provided. Default: Model's name</li> <li><code>scopeName</code>: Store value to use for each Model if not provided. Default: <code>_default</code></li> <li><code>idKey</code>: Value of the key to save your <strong>id</strong>. Default: Document's <code>id</code></li> <li><code>modelKey</code>: Key to store the model name into the document. Default: <code>_type</code></li> <li><code>populateMaxDeep</code>: Numeric Value for how many levels deep you want to <em>_populate</em>. Default: <code>1</code></li> <li><code>consistency</code>: Value for <em>Search Consistency Strategy</em>. Default: <code>SearchConsistency.NONE</code></li> <li><code>maxExpiry</code>: Numeric value (based in Milliseconds) used to create a collection for this instance. Default: <code>0</code></li> <li><code>keyGenerator</code>: Function to generate the key to store documents. Default: <code>(params: { metadata: ModelMetadata }) =&gt; string</code></li> <li><code>keyGeneratorDelimiter</code>: String value used to build the document key. Default: <code>::</code></li></ul> <p>The default implementation for the <code>keyGenerator</code> function is:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token function-variable function">KEY_GENERATOR</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> metadata <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>metadata<span class="token punctuation">.</span>modelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>keyGenerator</code> can be overridden for each <code>Model</code> if needed. check this in <a href="/guides/model.html#model-options">model options</a></p> <p><code>keyGeneratorDelimiter</code> has 2 restrictions:</p> <ol><li>Only supports up to 2 characters</li> <li>The available characters are <code>~!#$%&amp;*_\-:&lt;&gt;?</code></li></ol> <div class="custom-block warning"><p class="custom-block-title">Warning</p> <p>If the value provided to <code>keyGeneratorDelimiter</code> is invalid Ottoman will throw a <strong>BadKeyGeneratorDelimiterError</strong> exception.</p></div> <p>Some examples of <code>keyGeneratorDelimiter</code>:</p> <ul><li><code>::</code> *<em>default</em></li> <li><code>&amp;</code></li> <li><code>&amp;?</code></li> <li><code>_</code></li> <li><code>##</code></li></ul> <p><code>keyGeneratorDelimiter</code> can be overridden for each <code>Model</code> if needed. For more info see: <a href="/guides/model.html#model-options">model options</a></p> <h2 id="connections"><a href="#connections" class="header-anchor">#</a> Connections</h2> <p>All your <a href="/guides/model">Models</a> will be created via a connection and it will map to a Collection.</p> <h2 id="create-a-connection"><a href="#create-a-connection" class="header-anchor">#</a> Create a Connection</h2> <p>You can connect to Couchbase Server with the <a href="/classes/ottoman.html#connect">connect()</a> method.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// connected to Couchbase Server</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>This is the minimum needed to connect to the travel-sample bucket.
If the connection fails on your machine, try using <code>127.0.0.1</code> instead of <code>localhost</code>.</p> <h3 id="connection-string-anatomy"><a href="#connection-string-anatomy" class="header-anchor">#</a> Connection String Anatomy</h3> <p><img src="/assets/img/connection-anatomy.45f2e653.png" alt="Connection Anatomy"></p> <h2 id="connection-options"><a href="#connection-options" class="header-anchor">#</a> Connection Options</h2> <p><code>connect</code> function also supports a JavaScript object as a parameter.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">connectionString</span><span class="token operator">:</span> <span class="token string">'couchbase://localhost'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bucketName</span><span class="token operator">:</span> <span class="token string">'travel-sample'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'password'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The available connections options are:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">ConnectOptions</span> <span class="token punctuation">{</span>
  connectionString<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  bucketName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  authenticator<span class="token operator">?</span><span class="token operator">:</span> CertificateAuthenticator<span class="token punctuation">;</span>
  trustStorePath<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  transcoder<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  logFunc<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>transcoder</code>: Provides an interface for performing custom transcoding of document contents being retrieved and stored to the cluster. For more details see <a href="https://docs.couchbase.com/nodejs-sdk/current/howtos/transcoders-nonjson.html" target="_blank" rel="noopener noreferrer">transcoders-nonjson<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
<code>logFunc</code>: A callback function that receives the <code>entry</code> variable as paramater.</p> <h2 id="certificate-authentication"><a href="#certificate-authentication" class="header-anchor">#</a> Certificate Authentication</h2> <p>Couchbase Server supports the use of <strong>X.509</strong> certificates to authenticate clients (only available in the Enterprise Edition, not Community Edition). This allows authenticated users to access specific resources using the data service in Couchbase Server 5.1 and up and all other services in more recent releases of Couchbase Data Platform.</p> <p>The process relies on a certificate authority for the issuing of certificates that validate identities. A certificate includes information such as the name of the entity it identifies, an expiration date, the name of the authority that issued the certificate, and the digital signature of the authority. A client attempting to access Couchbase Server can present a certificate to the server allowing the server to check the validity of the certificate. If the certificate is valid, the user under whose identity the client is running and the roles assigned to that user are verified. If the assigned roles are appropriate for the level of access requested to the specified resource, access is granted.</p> <p>For a more detailed conceptual description of using certificates, see <a href="https://docs.couchbase.com/server/7.0/learn/security/certificates.html" target="_blank" rel="noopener noreferrer">Certificates<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="authenticating-ottoman-by-certificate"><a href="#authenticating-ottoman-by-certificate" class="header-anchor">#</a> Authenticating Ottoman by Certificate</h3> <p>For sample procedures whereby certificates can be generated and deployed,
see <a href="https://docs.couchbase.com/server/6.5/manage/manage-security/manage-certificates.html" target="_blank" rel="noopener noreferrer">Manage Certificates<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The rest of this document assumes that the processes there, or something similar, have been followed. That is, a cluster certificate has been created and installed on the server, a client certificate has been created, and it is stored in a JVM Keystore along with the clusterâ€™s certificate.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman<span class="token punctuation">,</span> CertificateAuthenticator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    connectionString<span class="token operator">:</span> <span class="token string">'couchbases://localhost'</span><span class="token punctuation">,</span>
    bucketName<span class="token operator">:</span> <span class="token string">'travel-sample'</span><span class="token punctuation">,</span>
    authenticator<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CertificateAuthenticator</span><span class="token punctuation">(</span>
      <span class="token string">&quot;/path/to/client/certificate.pem&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;/path/to/client/key.pem&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    trustStorePath<span class="token operator">:</span> <span class="token string">&quot;/path/to/ca/certificates.pem&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="default-ottoman-instance"><a href="#default-ottoman-instance" class="header-anchor">#</a> Default Ottoman Instance</h2> <p>Ottoman creates an instance by default to make the job easier.</p> <p>This instance is stored in the NodeJS process where the application runs and allows to use of the standalone functions <code>connect</code>,<code>model</code>, <code>start</code>,<code>close</code>.</p> <p>Let's see an example of how to create an Ottoman application.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Ottoman<span class="token punctuation">,</span> connect<span class="token punctuation">,</span> model<span class="token punctuation">,</span> start<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Create the ottoman instance</span>
  <span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Connect to DB</span>
  <span class="token keyword">await</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Define your model</span>
  <span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">model</span> <span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Bootstrap the application</span>
  <span class="token keyword">await</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Notice: We do not have to explicitly call the <code>connect</code>, <code>model</code>, or <code>start</code> methods using the Ottoman instance, since the first Ottoman instance created is registered and stored as the default instance which will be used by the standalone under the hood functions.</p> <p>e.g. <code>connect(...)</code> will run for the default instance like this <code>getDefaultInstance().connect(...)</code> Ottoman handles this logic for you.</p> <p>The default instance can be obtained with the <code>getDefaultInstance</code> function, which will return the default instance if it was created or<code>undefined</code> otherwise.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Ottoman<span class="token punctuation">,</span> getDefaultInstance<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ottoman1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ottoman2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Getting default instance</span>
<span class="token keyword">const</span> defaultInstance <span class="token operator">=</span> <span class="token function">getDefaultInstance</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// defaultInstance = ottoman1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>This can greatly simplify work in modular applications.</p> <h2 id="using-the-standalone-functions"><a href="#using-the-standalone-functions" class="header-anchor">#</a> Using the standalone functions</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect<span class="token punctuation">,</span> model <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// connecting to server</span>
  <span class="token keyword">await</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now you can use the model function to create Models in the default instance</span>
  <span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Notice we <a href="/classes/ottoman.html#start">start</a> using Ottoman without creating any instance, it's possible by using the <code>connect</code> function.
<code>connect</code> function will create a default ottoman instance with default options if there's not an ottoman default instance created yet.</p></div> <p>IMPORTANT: This will be the recommended way to use <code>Ottoman</code> if your app uses only 1 instance.
This way ottoman will save for you the Ottoman instance to work in any place of your code.</p> <p>Example <code>model</code> instead of <code>ottoman.model</code>.
Also there are <code>start</code>, <code>close</code>, <code>connect</code>, <code>getDefaultInstance</code>, <code>getCollections</code> functions are available for Ottoman default instance.</p> <h2 id="multiple-ottoman-instances"><a href="#multiple-ottoman-instances" class="header-anchor">#</a> Multiple Ottoman instances</h2> <p>Sometimes it is necessary to use different databases in the same application for some reason, it is not the common case but it is perfectly probable that at some point you will come across this use case. Ottoman provides multiple instance creation to solve this requirement, let's see how it works:</p> <p>So far we have used the default instance to connect, create the models, and even to start the application through the autonomous functions <code>connect</code>,<code>model</code>, <code>start</code>. These functions use the instance that Ottoman creates by default on the back to facilitate its handling, in this way the developer does not have to control the reference to the app instance. This works well and simplifies the work a lot, but sometimes it is necessary to use several databases in the same application, which Ottoman solves through multiple instances</p> <p>let's see an example:</p> <ol><li>Create the instance and connect it to the DB</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Ottoman<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>Create the models and start Ottoman.</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Ottoman<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> User <span class="token operator">=</span> ottoman<span class="token punctuation">.</span><span class="token function">model</span> <span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span>

  <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>With these simple steps, we create an Ottoman application as simple as possible.</p> <p>If we want to have multiple instances, we only have to repeat the steps described above, the code to create 2 instances would be left in this way:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Ottoman<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ottoman1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ottoman1<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> ottoman2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ottoman2<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/other-bucket@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// After connect you can create an explicitly Model from a given instance</span>

<span class="token comment">// Creating UserModel from ottoman1</span>
  <span class="token keyword">const</span> UserModel <span class="token operator">=</span> ottoman1<span class="token punctuation">.</span><span class="token function">model</span> <span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Creating CatModel from ottoman2</span>
  <span class="token keyword">const</span> CatModel <span class="token operator">=</span> ottoman2<span class="token punctuation">.</span><span class="token function">model</span> <span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>You can create as many Ottoman instances as you need, there is not a defined limit.</p> <div class="custom-block warning"><p class="custom-block-title">Strongly recommended for multiples instances</p> <p>When working with multiple instances avoid using the standalone functions (<code>connect</code>, <code>model</code>, <code>start</code>, and <code>close</code>), the recommended way is to use the desired Ottoman instance as a prefix ensuring that each component is registered in the correct instance.</p> <p>Example:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// working with multiple instances</span>
<span class="token keyword">await</span> ottoman1<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> ottoman2<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/other-bucket@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// not recommended</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Recommended (register explicitly model User to the ottoman2 Instance)</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> ottoman2<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div> <h2 id="closing-connections"><a href="#closing-connections" class="header-anchor">#</a> Closing Connections</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ottoman1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> ottoman1<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'couchbase://localhost/travel-sample@admin:password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Closing connection1</span>
ottoman1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Or just call the `close` function to close the default ottoman instance connection.</span>
<span class="token comment">// In this case, the `ottoman1` connection will be closed</span>
<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Always remember to close your connections.</p></div> <h2 id="not-using-scopes-collections"><a href="#not-using-scopes-collections" class="header-anchor">#</a> Not Using Scopes/Collections</h2> <p>If you don't want to use the <strong>scopes and collections</strong> approach, set the ottoman instances this way:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./ottoman&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">{</span> collectionName<span class="token operator">:</span> <span class="token string">'_default'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This way Ottoman will store all your data in a bucket.</p> <h2 id="bootstrapping"><a href="#bootstrapping" class="header-anchor">#</a> Bootstrapping</h2> <p>The <strong>Ottoman</strong> class will provide three main methods to bootstrap the app:</p> <ul><li><code>ensureCollections</code> will attempt to create collections and scopes for each model</li> <li><code>ensureIndexes</code> will attempt to create all indexes defined in the schema definition</li> <li><a href="/classes/ottoman.html#start">start</a> method is just a shortcut to run <code>ensureCollections</code> and <code>ensureIndexes</code></li></ul> <p>Notice: It's not required to execute the <code>start</code> method for Ottoman work.</p> <h2 id="setting-environment-variables"><a href="#setting-environment-variables" class="header-anchor">#</a> Setting Environment Variables</h2> <p>Ottoman provides a <code>set</code> function to help you define environment variables.
The next example will show how to set debug mode:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> set <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token comment">// Setting Ottoman in debuggin mode</span>
<span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'DEBUG'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Remember: You must define your environment variables at the very beginning.</p> <h2 id="events"><a href="#events" class="header-anchor">#</a> Events</h2> <p>Ottoman will enable you to handle some events:</p> <ul><li><code>IndexOnline</code></li></ul> <h3 id="event-indexonline"><a href="#event-indexonline" class="header-anchor">#</a> Event IndexOnline</h3> <p>This event will be trigger when the Ottoman's instance N1QL indexes are online to be used.</p> <p>usage:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Ottoman <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ottoman'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ottoman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ottoman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
  
  <span class="token operator">...</span> <span class="token comment">// do some stuff</span>
  
  <span class="token keyword">await</span> ottoman<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ottoman start will attempt to create scope/collections and indexes</span>
  
  <span class="token comment">// sometimes you will need to use the `IndexOnline` event</span>
  <span class="token comment">// to ensure the indexes were built and all the documents were indexed</span>
  <span class="token comment">// to can accept queries.</span>
  ottoman<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'IndexOnline'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// this way you can start your web-server with your database ready to work.</span>
      app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Notice: <code>IndexOnline</code> event will depend on <code>start</code> or <code>ensureIndexes</code> been called to be executed.</p> <h2 id="helper-functions"><a href="#helper-functions" class="header-anchor">#</a> Helper Functions</h2> <p>Ottoman provides these helpers functions:</p> <ul><li><a href="/classes/ottoman.html#dropbucket">dropBucket</a> drops a bucket from the cluster.</li> <li><a href="/classes/ottoman.html#dropscope">dropScope</a> drops a scope from a bucket.</li> <li><a href="/classes/ottoman.html#dropcollection">dropCollection</a> drops a collection from a scope in a bucket.</li></ul> <h2 id="next-up"><a href="#next-up" class="header-anchor">#</a> Next Up</h2> <p>Great job! Now we're connected, let's take a look at <a href="/guides/schema">Schemas</a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ec664b64.js" defer></script><script src="/assets/js/2.292e99e5.js" defer></script><script src="/assets/js/9.d862ec66.js" defer></script>
  </body>
</html>
