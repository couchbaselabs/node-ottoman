"use strict";(self.webpackChunkottoman_documentation=self.webpackChunkottoman_documentation||[]).push([[6877],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=o.createContext({}),m=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=m(e.components);return o.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=m(n),d=r,g=p["".concat(i,".").concat(d)]||p[d]||u[d]||a;return n?o.createElement(g,s(s({ref:t},c),{},{components:n})):o.createElement(g,s({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=p;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var m=2;m<a;m++)s[m]=n[m];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5490:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>m});var o=n(7462),r=(n(7294),n(3905));const a={},s="Ottoman V1 to Ottoman V2",l={unversionedId:"advanced/ottomanV1-to-ottomanV2",id:"advanced/ottomanV1-to-ottomanV2",title:"Ottoman V1 to Ottoman V2",description:"Ottoman, for Couchbase, is an object document mapper (ODM) that allows you build what your object model would look like,",source:"@site/docs/advanced/ottomanV1-to-ottomanV2.md",sourceDirName:"advanced",slug:"/advanced/ottomanV1-to-ottomanV2",permalink:"/docs/advanced/ottomanV1-to-ottomanV2",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Ottoman for Couchbase Node.js SDK developers",permalink:"/docs/advanced/ottoman-couchbase"},next:{title:"Ottoman Vs SDK Comparison",permalink:"/docs/advanced/sdk-comparison"}},i={},m=[{value:"Import Ottoman Module",id:"import-ottoman-module",level:2},{value:"Couchbase Bucket Connection",id:"couchbase-bucket-connection",level:2},{value:"Sample Model Definition",id:"sample-model-definition",level:2},{value:"Create New User Documents",id:"create-new-user-documents",level:3},{value:"Persist Documents to Our Bucket",id:"persist-documents-to-our-bucket",level:2},{value:"Retrieve Records From our Bucket",id:"retrieve-records-from-our-bucket",level:2},{value:"Updating an Existing Document",id:"updating-an-existing-document",level:2}],c={toc:m};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"ottoman-v1-to-ottoman-v2"},"Ottoman V1 to Ottoman V2"),(0,r.kt)("p",null,"Ottoman, for Couchbase, is an object document mapper (ODM) that allows you build what your object model would look like,\nthen auto-generate all the boilerplate logic that goes with it."),(0,r.kt)("p",null,"Ottoman us to easily access CRUD commands for Couchbase Server using Node.js. To use Ottoman, make sure you add it to\nyour Node.js project by using the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"npm install ottoman\n")),(0,r.kt)("p",null,"Or using yarn:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn add ottoman\n")),(0,r.kt)("h2",{id:"import-ottoman-module"},"Import Ottoman Module"),(0,r.kt)("p",null,"Now that the libraries have been downloaded to our project, we need to include it in our source code. This can be done\nby adding the following code:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"V1"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const ottoman = require('ottoman');\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Current Version"))),(0,r.kt)("p",null,"Current version entirely have support for typescript and you can also do:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {getDefaultInstance, Ottoman} from 'ottoman';\n")),(0,r.kt)("h2",{id:"couchbase-bucket-connection"},"Couchbase Bucket Connection"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"V1"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"ottoman.bucket = (new couchbase.Cluster('http://127.0.0.1:8091')).openBucket('bucket-name-here');\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Current Version"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// get the default Ottoman instance\nlet ottoman = getDefaultInstance();\n\nif (!ottoman) {\n  // if not exist default one, then create\n  ottoman = new Ottoman({collectionName: '_default'});\n}\n\nconst main = async () => {\n  await ottoman.connect({\n    connectionString: 'couchbase://127.0.0.1', // with default port 8091\n    bucketName: 'bucket-name-here',\n    username: 'Administrator',\n    password: 'password'\n  });\n}\n\nmain();\n")),(0,r.kt)("h2",{id:"sample-model-definition"},"Sample Model Definition"),(0,r.kt)("p",null,"Before we can start doing CRUD operations against Couchbase, we need to define our Ottoman model. These models represent\ndocuments in our database."),(0,r.kt)("p",null,"The models we create with Ottoman can have properties and methods."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"V1"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const UserModel = ottoman.model('User', {\n  firstName: {type: 'string'},\n  lastName: {type: 'string'},\n  email: {type: 'string'}\n});\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Current Version"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const UserModel = ottoman.model('User', {\n  firstName: String,\n  lastName: String,\n  email: String\n})\n")),(0,r.kt)("h3",{id:"create-new-user-documents"},"Create New User Documents"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myUser = new UserModel({\n  firstName: 'Perry',\n  lastName: 'Mason',\n  email: 'perry.mason@example.com',\n});\n")),(0,r.kt)("h2",{id:"persist-documents-to-our-bucket"},"Persist Documents to Our Bucket"),(0,r.kt)("p",null,"So far we have simply defined the model structure and created documents locally. Now we can persist the documents\ncalling Ottoman's ",(0,r.kt)("inlineCode",{parentName:"p"},"save()")," method on each object:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"V1"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'myUser.save(function (error) {\n  if (error) {\n    console.log("An error happened:" + JSON.stringify(error));\n    return;\n  }\n  console.log(`SUCCESS: user ${myUser.firstName} added!`);\n});\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Current Version"))),(0,r.kt)("p",null,"Using the async/await technique:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const runAsync = async () => {\n  await myUser.save();\n  console.log(`SUCCESS: user ${myUser.firstName} added!`);\n}\n\nottoman.start()\n  .then(runAsync)\n  .catch((error) => console.log('An error happened: ' + JSON.stringify(error)))\n  .finally(process.exit)\n")),(0,r.kt)("p",null,"The output will be something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"> SUCCESS: user Perry added!\n")),(0,r.kt)("h2",{id:"retrieve-records-from-our-bucket"},"Retrieve Records From our Bucket"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"V1"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// Finding All Documents\nUserModel.find({}, function (error, result) {\n  // Do something with the resulting Ottoman models\n});\n\n// Finding a Specific Document\nUserModel.find({lastName: 'Mason'}, function (error, result) {\n  // Do something with the resulting Ottoman model\n});\n\n// Find a Document by ID\nUserModel.getById('document-id-here', function (error, result) {\n  // Do something with the resulting Ottoman model\n});\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Current Version"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Finding All Documents\nawait UserModel.find({}, {select: 'firstName,email', limit: 20});\n\n// Finding a Specific Document\nawait UserModel.find({lastName: 'Mason'});\n\n// Find a Document by ID\nawait UserModel.findById('document-id-here');\n")),(0,r.kt)("h2",{id:"updating-an-existing-document"},"Updating an Existing Document"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"V1"))),(0,r.kt)("p",null,"Updating documents in Version1 with Ottoman can be a little tricky because you must first have loaded the document\nbefore trying to do a manipulation on it. What you could do is find the particular document by id, then perform the save\ncommand like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"UserModel.getById('document-id-here', function (error, result) {\n  if (error) {\n    console.log('An error happened: ' + JSON.stringify(error));\n  }\n  result.firstname = 'Nicolas',\n    result.save(function (error) {\n      if (error) {\n        console.log('An error happened: ' + JSON.stringify(error));\n      }\n    });\n});\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Current version"))),(0,r.kt)("p",null,"Is more simple do that with current version:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await UserModel.updateById('document-id-here', {firstname: 'Nicolas'});\n")))}u.isMDXComponent=!0}}]);